<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title></title>
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Fabrice Niessen" />
<meta  name="description" content="Orgmk completely automates the export of Org documents."
 />
<meta  name="keywords" content="org-mode, orgmk, export, automate, emacs, pdf, latex, html" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/hideshow.css"/>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/bigblow.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/hideshow.js"></script>
</head>
<body>
<div id="content">

<div id="outline-container-orgheadline84" class="outline-2">
<h2 id="orgheadline84"><span class="section-number-2">1</span> Export Org mode documents to HTML, PDF, etc. <a href="http://opensource.org/licenses/GPL-3.0"><object type="image/svg+xml" data="http://img.shields.io/:license-gpl-blue.svg" >
Sorry, your browser does not support SVG.</object></a> <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_donations&amp;business=VCVAS6KPDQ4JC&amp;lc=BE&amp;item_number=orgmk&amp;currency_code=EUR&amp;bn=PP-DonationsBF:btn_donate_LG.gif:NonHosted"><img src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" alt="btn_donate_LG.gif" /></a></h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-orgheadline8" class="outline-3">
<h3 id="orgheadline8"><span class="section-number-3">1.1</span> Overview</h3>
<div class="outline-text-3" id="text-1-1">
</div><div id="outline-container-orgheadline1" class="outline-4">
<h4 id="orgheadline1"><span class="section-number-4">1.1.1</span> Description</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
Orgmk is a suite of Bash scripts for <b>automating the conversion of Org mode
documents to different formats</b> (such as HTML or PDF) from the command line.
</p>

<script src="http://platform.twitter.com/widgets.js"></script>
<a href="https://twitter.com/share" class="twitter-share-button" data-via="f_niessen">Tweet</a>

<p>
The scripts run on both Unix and Microsoft Windows (with Cygwin).
</p>
</div>
</div>

<div id="outline-container-orgheadline2" class="outline-4">
<h4 id="orgheadline2"><span class="section-number-4">1.1.2</span> Objectives</h4>
<div class="outline-text-4" id="text-1-1-2">
<p>
The first goal is to <b>be more productive</b>, by running the export only when the
source Org files are updated.
</p>

<p>
The second goal is to <b>share some common Emacs and Org configuration inside your</b>
<b>team</b>, separately of what you have in your personal Emacs configuration file.
</p>

<p>
Finally, the third goal is also to <b>offload compilation into an external batch
Emacs process</b>, allowing you to go on editing or working while exporting the
documents.
</p>
</div>
</div>

<div id="outline-container-orgheadline3" class="outline-4">
<h4 id="orgheadline3"><span class="section-number-4">1.1.3</span> Quotations</h4>
<div class="outline-text-4" id="text-1-1-3">
<p>
&ldquo;If one has been trying to bulk convert many quickly changing org-documents,
[one] will appreciate the power and flexibility of this tool.&rdquo; <br  />
&#x2013; <i>z27</i>
</p>

<p>
&ldquo;orgmk is a wonderful tool, and, as far as I know, still unique.&rdquo; <br  />
&#x2013; <i>Priyadarshan</i>
</p>
</div>
</div>

<div id="outline-container-orgheadline7" class="outline-4">
<h4 id="orgheadline7"><span class="section-number-4">1.1.4</span> Requirements</h4>
<div class="outline-text-4" id="text-1-1-4">
</div>

<div id="outline-container-orgheadline4" class="outline-5">
<h5 id="orgheadline4">Emacs 24</h5>
<div class="outline-text-5" id="text-orgheadline4">
<p>
Emacs version 24 (for the &ldquo;package&rdquo; facility) must be in your <code>PATH</code>.
</p>
</div>
</div>

<div id="outline-container-orgheadline5" class="outline-5">
<h5 id="orgheadline5">Org 8</h5>
<div class="outline-text-5" id="text-orgheadline5">
<p>
Org mode version 8 (or later) is required.
</p>

<p>
If such a version is not bundled with your Emacs, Org 8 will be automatically
installed &#x2013; if you accept it! &#x2013; through ELPA.
</p>
</div>
</div>

<div id="outline-container-orgheadline6" class="outline-5">
<h5 id="orgheadline6">LaTeX (PDF)</h5>
<div class="outline-text-5" id="text-orgheadline6">
<p>
A working LaTeX installation is required for exporting to PDF. If it is not
yet installed on your system, install <a href="http://www.tug.org/texlive/">TeX Live</a> (for example).
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline11" class="outline-3">
<h3 id="orgheadline11"><span class="section-number-3">1.2</span> Usage</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Org files can have the extension <code>.org</code> or <code>.txt</code>.
</p>
</div>

<div id="outline-container-orgheadline9" class="outline-4">
<h4 id="orgheadline9"><span class="section-number-4">1.2.1</span> Standalone scripts</h4>
<div class="outline-text-4" id="text-1-2-1">
<ul class="org-ul">
<li><p>
For &ldquo;weaving&rdquo; files (producing the formatted documentation files):
</p>

<div class="org-src-container">

<pre class="src src-shell">org2html [OPTION] FILE
org2latex [OPTION] FILE
org2pdf [OPTION] FILE
org2beamerpdf [OPTION] FILE
org2odt [OPTION] FILE
org2txt [OPTION] FILE
</pre>
</div></li>

<li><p>
For &ldquo;tangling&rdquo; files:
</p>

<div class="org-src-container">

<pre class="src src-shell">org-tangle FILE
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline10" class="outline-4">
<h4 id="orgheadline10"><span class="section-number-4">1.2.2</span> Makefile wrapper</h4>
<div class="outline-text-4" id="text-1-2-2">
<div class="org-src-container">

<pre class="src src-shell">orgmk [OPTION]
orgmk [OPTION] [html | pdf]
orgmk [OPTION] [FILE]
</pre>
</div>

<p>
Currently, <code>orgmk</code> does not tangle Org files.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline14" class="outline-3">
<h3 id="orgheadline14"><span class="section-number-3">1.3</span> Options</h3>
<div class="outline-text-3" id="text-1-3">
</div><div id="outline-container-orgheadline12" class="outline-4">
<h4 id="orgheadline12"><span class="section-number-4">1.3.1</span> Standalone scripts</h4>
<div class="outline-text-4" id="text-1-3-1">
<dl class="org-dl">
<dt><code>-h</code>, <code>--help</code></dt><dd>Print usage information and exit.</dd>

<dt><code>-y</code></dt><dd><p>
     Authorize the update of the source file (update of dynamic blocks and
re-computation of tables) without confirmation.
</p>

<p>
Before the conversion, the standalone scripts will try to <b>update all
dynamic blocks and recompute all tables</b> in the source Org file, a
<b>potentially destructive operation</b> for which the programs require
confirmation: in case the source file gets updated, you will be queried to
overwrite the source file with the updated version of the file &#x2013; that&rsquo;s
because the environment variable <code>UPDATE_SRC</code> defaults to <code>query</code>.
</p>

<p>
To avoid the question, you can also set that variable to <code>yes</code> or <code>no</code> in a
personal configuration file, <code>~/.orgmk-rc</code>.
</p>

<p>
Note that, by design, the command line argument <code>-y</code> is passed to every
<code>org2&lt;BACKEND&gt;</code> script called from <code>orgmk</code>, so that <code>orgmk</code> doesn&rsquo;t wait for
answers.
</p></dd>

<dt><code>--body-only</code></dt><dd>Export only body (for HTML and LaTeX).</dd>
</dl>
</div>
</div>

<div id="outline-container-orgheadline13" class="outline-4">
<h4 id="orgheadline13"><span class="section-number-4">1.3.2</span> Makefile wrapper</h4>
<div class="outline-text-4" id="text-1-3-2">
<dl class="org-dl">
<dt><code>-h</code>, <code>--help</code></dt><dd>Print usage information and exit.</dd>

<dt><code>-r</code>, <code>--recursive</code></dt><dd><p>
     Export all Org files <b>under each directory, recursively</b>.
</p>

<p>
It just calls <code>orgmk.mk</code> with the argument <code>ALLSUBDIRS=yes</code>.
</p>

<p>
By default, <code>orgmk</code> exports all Org files (which need it) in the current
directory only.
</p></dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-orgheadline15" class="outline-3">
<h3 id="orgheadline15"><span class="section-number-3">1.4</span> Files</h3>
<div class="outline-text-3" id="text-1-4">
<p>
<a href="file:///cygdrive/d/Users/fni/.orgmk-rc">file:///cygdrive/d/Users/fni/.orgmk-rc</a>
</p>
</div>
</div>

<div id="outline-container-orgheadline19" class="outline-3">
<h3 id="orgheadline19"><span class="section-number-3">1.5</span> Examples</h3>
<div class="outline-text-3" id="text-1-5">
</div><div id="outline-container-orgheadline16" class="outline-4">
<h4 id="orgheadline16"><span class="section-number-4">1.5.1</span> Update all documents</h4>
<div class="outline-text-4" id="text-1-5-1">
<p>
Regenerate HTML and/or PDF files for Org files that have been modified.
</p>

<div class="org-src-container">

<pre class="src src-shell">orgmk
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline17" class="outline-4">
<h4 id="orgheadline17"><span class="section-number-4">1.5.2</span> Update specific types of documents</h4>
<div class="outline-text-4" id="text-1-5-2">
<p>
Regenerate HTML only for the Org files that have been changed.
</p>

<div class="org-src-container">

<pre class="src src-shell">orgmk html
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline18" class="outline-4">
<h4 id="orgheadline18"><span class="section-number-4">1.5.3</span> Update specific document</h4>
<div class="outline-text-4" id="text-1-5-3">
<p>
Regenerate (or create for the first time) the file <code>thesis.pdf</code> from the Org file
<code>thesis.org</code> or <code>thesis.txt</code>. <b>Don't require confirmation for updating the source
file.</b>
</p>

<div class="org-src-container">

<pre class="src src-shell">orgmk thesis.pdf
</pre>
</div>

<p>
Regenerate (or create for the first time) the file <code>thesis.pdf</code> from the Org file
<code>thesis.org</code>. Require confirmation for updating the source file.
</p>

<div class="org-src-container">

<pre class="src src-shell">org2pdf thesis.org
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline22" class="outline-3">
<h3 id="orgheadline22"><span class="section-number-3">1.6</span> Installation</h3>
<div class="outline-text-3" id="text-1-6">
<p>
The installation process consists of creating symbolic links from the standard
<b>final directories</b> on your machine to the <code>orgmk</code> executables.
</p>
</div>

<div id="outline-container-orgheadline20" class="outline-4">
<h4 id="orgheadline20"><span class="section-number-4">1.6.1</span> New install</h4>
<div class="outline-text-4" id="text-1-6-1">
<ol class="org-ol">
<li><p>
<b>Extract</b> the latest version of <code>orgmk</code>.
</p>

<div class="org-src-container">

<pre class="src src-shell">git clone git@github.com:fniessen/orgmk.git
</pre>
</div></li>

<li><p>
Create configuration files which record where <code>orgmk</code> has been extracted
on your host machine.
</p>

<div class="org-src-container">

<pre class="src src-shell">make
</pre>
</div></li>

<li><p>
By default, the <code>orgmk</code> executable and the standalone scripts (<code>org2html</code>,
<code>org2pdf</code>, etc.) are installed to the <code>/usr/local/bin</code> so that all users are
able to run them.
</p>

<p>
If you want to <b>change the destination directory</b>, create a <code>Make.params</code> file
with the target directory. For example:
</p>

<div class="org-src-container">

<pre class="src src-makefile"><span class="org-variable-name">BIN_DIR</span>=~/bin
</pre>
</div>

<p>
If needed, add that directory to your <code>PATH</code>.
</p>

<p>
<b>Install</b> <code>orgmk</code> (executable and standalone scripts that you run) to the
<code>BIN_DIR</code> location by typing:
</p>

<div class="org-src-container">

<pre class="src src-shell">make install
</pre>
</div></li>
</ol>

<p>
At this point, everything should be ready for use.
</p>
</div>
</div>

<div id="outline-container-orgheadline21" class="outline-4">
<h4 id="orgheadline21"><span class="section-number-4">1.6.2</span> Makefile for installation</h4>
<div class="outline-text-4" id="text-1-6-2">
<div class="org-src-container">

<pre class="src src-makefile"><span class="org-comment-delimiter">### </span><span class="org-comment">-*- Makefile -*- definition file for Orgmk</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">To install `orgmk', type `make' and then `make install'.</span>

<span class="org-variable-name">PWD</span>=$(<span class="org-variable-name">shell</span> pwd)

<span class="org-variable-name">BIN_DIR</span>=/usr/local/bin

-include Make.params

<span class="org-variable-name">ORGMK_ROOT</span>=$(<span class="org-variable-name">PWD</span>)
<span class="org-variable-name">ORGMK_EL</span>=$(<span class="org-variable-name">ORGMK_ROOT</span>)/site-lisp/orgmk.el

<span class="org-comment-delimiter"># </span><span class="org-comment">WARNING: ORGMK_EL must contain the correct path to the</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">`orgmk.el' file according to the Emacs version used (Windows,</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">Cygwin or Linux path)</span>
<span class="org-variable-name">EMACS_SYSTEM_TYPE</span>=$(<span class="org-variable-name">shell</span> emacs -batch --eval <span class="org-string">"(message \"%s\" system-type)"</span> 2&gt;&amp;1)
ifeq ($(<span class="org-variable-name">EMACS_SYSTEM_TYPE</span>),windows-nt)
    <span class="org-variable-name">ORGMK_EL</span>:=<span class="org-string">"$(</span><span class="org-variable-name"><span class="org-string">shell</span></span><span class="org-string"> cygpath --mixed $(</span><span class="org-variable-name"><span class="org-string">ORGMK_EL</span></span><span class="org-string">))"</span>
endif

<span class="org-variable-name">ORGMK_INIT</span>=orgmk-init
<span class="org-variable-name">ORGMK_SYSTEM_CONFIG</span>=orgmk.conf
<span class="org-variable-name">ORGMK_UPDATE</span>=orgmk-update-src
<span class="org-variable-name">ORGMK_UPDATE_CHECK_DIFF</span>=orgmk-update-src-check-diff
<span class="org-variable-name">ORG2HTML</span>=org2html
<span class="org-variable-name">ORG2LATEX</span>=org2latex
<span class="org-variable-name">ORG2PDF</span>=org2pdf
<span class="org-variable-name">ORG2BEAMERPDF</span>=org2beamerpdf
<span class="org-variable-name">ORG2ODT</span>=org2odt
<span class="org-variable-name">ORG2TXT</span>=org2txt
<span class="org-variable-name">ORGTANGLE</span>=org-tangle
<span class="org-variable-name">ORGMK_MAKE_SETUP</span>=orgmk-stow-orgmk.mk
<span class="org-variable-name">ORGMK_MAKE_RUN</span>=orgmk

<span class="org-comment-delimiter">## </span><span class="org-comment">MAKE</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">Ensure `all' is the default target</span>
<span class="org-makefile-targets">all</span>: orgmk-system-config orgmk-stow-mk  <span class="org-comment-delimiter"># </span><span class="org-comment">Create Orgmk system files</span>

<span class="org-makefile-targets">.PHONY</span>: orgmk-system-config
<span class="org-makefile-targets">orgmk-system-config</span>:                    <span class="org-comment-delimiter"># </span><span class="org-comment">Create file with location of `orgmk.el'</span>
<span class="org-whitespace-tab">        </span><span class="org-type">@</span><span class="org-makefile-shell">echo </span><span class="org-makefile-shell"><span class="org-string">"Generating system-wide configuration file..."</span></span>
<span class="org-whitespace-tab">        </span>echo <span class="org-string">"ORGMK_EL=$(</span><span class="org-variable-name"><span class="org-string">ORGMK_EL</span></span><span class="org-string">)"</span> &gt; bin/$(<span class="org-variable-name">ORGMK_SYSTEM_CONFIG</span>)
<span class="org-whitespace-tab">        </span><span class="org-type">@</span><span class="org-makefile-shell">echo</span>

<span class="org-makefile-targets">.PHONY</span>: orgmk-stow-mk
<span class="org-makefile-targets">orgmk-stow-mk</span>:                          <span class="org-comment-delimiter"># </span><span class="org-comment">Create core file for `orgmk'</span>
<span class="org-whitespace-tab">        </span><span class="org-type">@</span><span class="org-makefile-shell">echo </span><span class="org-makefile-shell"><span class="org-string">"Generating setup file..."</span></span>
<span class="org-whitespace-tab">        </span>echo <span class="org-string">"#!/bin/sh"</span> &gt; bin/$(<span class="org-variable-name">ORGMK_MAKE_SETUP</span>)
<span class="org-whitespace-tab">        </span>echo <span class="org-string">"ln -f -s $(</span><span class="org-variable-name"><span class="org-string">PWD</span></span><span class="org-string">)/bin/orgmk.mk orgmk.mk"</span> &gt;&gt; bin/$(<span class="org-variable-name">ORGMK_MAKE_SETUP</span>)
<span class="org-whitespace-tab">        </span>chmod u+x bin/$(<span class="org-variable-name">ORGMK_MAKE_SETUP</span>)
<span class="org-whitespace-tab">        </span><span class="org-type">@</span><span class="org-makefile-shell">echo</span>

<span class="org-comment-delimiter">## </span><span class="org-comment">MAKE INSTALL</span>

<span class="org-makefile-targets">.PHONY</span>: install
<span class="org-makefile-targets">install</span>:                                <span class="org-comment-delimiter"># </span><span class="org-comment">Create symlinks to Orgmk scripts</span>
<span class="org-whitespace-tab">        </span><span class="org-type">@</span><span class="org-makefile-shell">echo </span><span class="org-makefile-shell"><span class="org-string">"Creating symlinks..."</span></span>
<span class="org-whitespace-tab">        </span>ln -f -s $(<span class="org-variable-name">PWD</span>)/bin/$(<span class="org-variable-name">ORGMK_INIT</span>)              $(<span class="org-variable-name">BIN_DIR</span>)/$(<span class="org-variable-name">ORGMK_INIT</span>)
<span class="org-whitespace-tab">        </span>ln -f -s $(<span class="org-variable-name">PWD</span>)/bin/$(<span class="org-variable-name">ORGMK_SYSTEM_CONFIG</span>)     $(<span class="org-variable-name">BIN_DIR</span>)/$(<span class="org-variable-name">ORGMK_SYSTEM_CONFIG</span>)
<span class="org-whitespace-tab">        </span>ln -f -s $(<span class="org-variable-name">PWD</span>)/bin/$(<span class="org-variable-name">ORGMK_UPDATE</span>)            $(<span class="org-variable-name">BIN_DIR</span>)/$(<span class="org-variable-name">ORGMK_UPDATE</span>)
<span class="org-whitespace-tab">        </span>ln -f -s $(<span class="org-variable-name">PWD</span>)/bin/$(<span class="org-variable-name">ORGMK_UPDATE_CHECK_DIFF</span>) $(<span class="org-variable-name">BIN_DIR</span>)/$(<span class="org-variable-name">ORGMK_UPDATE_CHECK_DIFF</span>)
<span class="org-whitespace-tab">        </span>ln -f -s $(<span class="org-variable-name">PWD</span>)/bin/$(<span class="org-variable-name">ORG2HTML</span>)                $(<span class="org-variable-name">BIN_DIR</span>)/$(<span class="org-variable-name">ORG2HTML</span>)
<span class="org-whitespace-tab">        </span>ln -f -s $(<span class="org-variable-name">PWD</span>)/bin/$(<span class="org-variable-name">ORG2LATEX</span>)               $(<span class="org-variable-name">BIN_DIR</span>)/$(<span class="org-variable-name">ORG2LATEX</span>)
<span class="org-whitespace-tab">        </span>ln -f -s $(<span class="org-variable-name">PWD</span>)/bin/$(<span class="org-variable-name">ORG2PDF</span>)                 $(<span class="org-variable-name">BIN_DIR</span>)/$(<span class="org-variable-name">ORG2PDF</span>)
<span class="org-whitespace-tab">        </span>ln -f -s $(<span class="org-variable-name">PWD</span>)/bin/$(<span class="org-variable-name">ORG2BEAMERPDF</span>)           $(<span class="org-variable-name">BIN_DIR</span>)/$(<span class="org-variable-name">ORG2BEAMERPDF</span>)
<span class="org-whitespace-tab">        </span>ln -f -s $(<span class="org-variable-name">PWD</span>)/bin/$(<span class="org-variable-name">ORG2ODT</span>)                 $(<span class="org-variable-name">BIN_DIR</span>)/$(<span class="org-variable-name">ORG2ODT</span>)
<span class="org-whitespace-tab">        </span>ln -f -s $(<span class="org-variable-name">PWD</span>)/bin/$(<span class="org-variable-name">ORG2TXT</span>)                 $(<span class="org-variable-name">BIN_DIR</span>)/$(<span class="org-variable-name">ORG2TXT</span>)
<span class="org-whitespace-tab">        </span>ln -f -s $(<span class="org-variable-name">PWD</span>)/bin/$(<span class="org-variable-name">ORGTANGLE</span>)               $(<span class="org-variable-name">BIN_DIR</span>)/$(<span class="org-variable-name">ORGTANGLE</span>)
<span class="org-whitespace-tab">        </span>ln -f -s $(<span class="org-variable-name">PWD</span>)/bin/$(<span class="org-variable-name">ORGMK_MAKE_SETUP</span>)        $(<span class="org-variable-name">BIN_DIR</span>)/$(<span class="org-variable-name">ORGMK_MAKE_SETUP</span>)
<span class="org-whitespace-tab">        </span>ln -f -s $(<span class="org-variable-name">PWD</span>)/bin/$(<span class="org-variable-name">ORGMK_MAKE_RUN</span>)          $(<span class="org-variable-name">BIN_DIR</span>)/$(<span class="org-variable-name">ORGMK_MAKE_RUN</span>)

<span class="org-comment-delimiter">### </span><span class="org-comment">Makefile ends here</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline36" class="outline-3">
<h3 id="orgheadline36"><span class="section-number-3">1.7</span> Standalone scripts</h3>
<div class="outline-text-3" id="text-1-7">
</div>

<div id="outline-container-orgheadline25" class="outline-4">
<h4 id="orgheadline25"><span class="section-number-4">1.7.1</span> Orgmk-init</h4>
<div class="outline-text-4" id="text-1-7-1">
<p>
The <code>orgmk-init</code> script contains the common part used to setup Emacs
and Org in order to export to HTML, PDF, etc.
</p>
</div>

<div id="outline-container-orgheadline23" class="outline-5">
<h5 id="orgheadline23">Functions</h5>
<div class="outline-text-5" id="text-orgheadline23">
<div class="org-src-container">

<pre class="src src-shell"><span class="org-function-name">Usage</span> ()
{
    cat &lt;&lt; EOF 1&gt;&amp;2
<span class="org-sh-heredoc">Usage: $(basename $0) [OPTION] FILE</span>
<span class="org-sh-heredoc">Convert FILE to another format.</span>

<span class="org-sh-heredoc">  -h, --help     display this help and exit</span>
<span class="org-sh-heredoc">  -y             authorize update of the source file without confirmation</span>
<span class="org-sh-heredoc">  --body-only    export only body (for HTML and LaTeX exports)</span>

<span class="org-sh-heredoc">Report $(basename $0) bugs to fni@missioncriticalit.com</span>
<span class="org-sh-heredoc">EOF</span>
    <span class="org-keyword">exit</span> 1
}
</pre>
</div>

<div class="org-src-container">

<pre class="src src-shell"><span class="org-function-name">die</span> () {
    printf <span class="org-string">"$(basename $0): $@\n"</span> &gt; /dev/stderr
    <span class="org-keyword">exit</span> 2 <span class="org-comment-delimiter"># </span><span class="org-comment">an error occurred</span>
}
</pre>
</div>

<div class="org-src-container">

<pre class="src src-shell"><span class="org-function-name">CleanUp</span> ()
{
    <span class="org-comment-delimiter"># </span><span class="org-comment">restore backed up target file if it hasn't been produced</span>
    <span class="org-keyword">if</span> [ <span class="org-negation-char">!</span> -z $<span class="org-variable-name">FILE_TARGET</span> ]; <span class="org-keyword">then</span>
        <span class="org-keyword">if</span> [ -r $<span class="org-variable-name">FILE_TARGET</span>.orig ]; <span class="org-keyword">then</span>
            <span class="org-keyword">if</span> [ <span class="org-negation-char">!</span> -r $<span class="org-variable-name">FILE_TARGET</span> ]; <span class="org-keyword">then</span>
                printf <span class="org-string">"Recovering OLD file $FILE_TARGET...\n"</span>
                mv $<span class="org-variable-name">FILE_TARGET</span>.orig $<span class="org-variable-name">FILE_TARGET</span>
            <span class="org-keyword">else</span>
                rm $<span class="org-variable-name">FILE_TARGET</span>.orig
            <span class="org-keyword">fi</span>
        <span class="org-keyword">fi</span>
    <span class="org-keyword">fi</span>

    <span class="org-comment-delimiter"># </span><span class="org-comment">display log file, if present</span>
    <span class="org-keyword">if</span> [ <span class="org-negation-char">!</span> -z $<span class="org-variable-name">FILE_LOG</span> ]; <span class="org-keyword">then</span>
        <span class="org-keyword">if</span> [ -r $<span class="org-variable-name">FILE_LOG</span> ]; <span class="org-keyword">then</span>
            grep -e <span class="org-string">"^!.*"</span> -A 3 -B 1 $<span class="org-variable-name">FILE_LOG</span>
        <span class="org-keyword">fi</span>
    <span class="org-keyword">fi</span>

    <span class="org-comment-delimiter"># </span><span class="org-comment">remove the temporary copy of the source Org file</span>
    <span class="org-keyword">if</span> [ <span class="org-negation-char">!</span> -z $<span class="org-variable-name">FILE_SRC_UPDT</span> ]; <span class="org-keyword">then</span>
        rm -f $<span class="org-variable-name">FILE_SRC_UPDT</span>
    <span class="org-keyword">fi</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline24" class="outline-5">
<h5 id="orgheadline24">Runtime</h5>
<div class="outline-text-5" id="text-orgheadline24">
<div class="org-src-container">

<pre class="src src-emacs-lisp" id="orgsrcblock1">(format-time-string <span class="org-string">"%Y%m%d.%H%M"</span>)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-shell">    cat &lt;&lt; EOF
<span class="org-sh-heredoc">This is $(basename $0), version: 20150528.0930.</span>
<span class="org-sh-heredoc">EOF</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-shell"><span class="org-comment-delimiter"># </span><span class="org-comment">perform housekeeping on program exit or a variety of signals</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">(EXIT, HUP, INT, QUIT, TERM)</span>
<span class="org-keyword">trap</span> CleanUp 0 1 2 3 15
</pre>
</div>

<div class="org-src-container">

<pre class="src src-shell"><span class="org-comment-delimiter"># </span><span class="org-comment">load the system-wide config file (definition of `ORGMK_EL')</span>
. orgmk.conf

<span class="org-keyword">if</span> [ <span class="org-string">"$ORGMK_EL"</span> = <span class="org-string">""</span> ]; <span class="org-keyword">then</span>
    printf <span class="org-string">"ORGMK_EL variable not defined, please check your setup!\n"</span>
    <span class="org-keyword">exit</span> 2
<span class="org-keyword">fi</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">source the user config file (default for `UPDATE_SRC', etc.)</span>
<span class="org-variable-name">ORGMK_USER_CONF</span>=$<span class="org-variable-name">HOME</span>/.orgmk-rc
<span class="org-keyword">if</span> [ -r $<span class="org-variable-name">ORGMK_USER_CONF</span> ]; <span class="org-keyword">then</span>
    . $<span class="org-variable-name">ORGMK_USER_CONF</span>
<span class="org-keyword">fi</span>

<span class="org-builtin">export</span> UPDATE_SRC

<span class="org-comment-delimiter"># </span><span class="org-comment">set a default value</span>
<span class="org-builtin">export</span> <span class="org-variable-name">BODY_ONLY</span>=<span class="org-string">"no"</span>

<span class="org-keyword">while </span><span class="org-builtin">true</span>; <span class="org-keyword">do</span>
    <span class="org-keyword">case</span> <span class="org-string">"$1"</span><span class="org-keyword"> in</span>
        -y ) <span class="org-variable-name">UPDATE_SRC</span>=<span class="org-string">"yes"</span>; <span class="org-builtin">shift</span> ;;
        --body-only ) <span class="org-variable-name">BODY_ONLY</span>=<span class="org-string">"yes"</span>; <span class="org-builtin">shift</span> ;;
        -h | --help ) Usage ;;
        * ) <span class="org-keyword">break</span> ;;
    <span class="org-keyword">esac</span>
<span class="org-keyword">done</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">now do something with $@</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-shell"><span class="org-keyword">if</span> [ $<span class="org-variable-name">#</span> -ne 1 ]; <span class="org-keyword">then</span>
    Usage
<span class="org-keyword">fi</span>

<span class="org-variable-name">FILE_SRC_ORIG</span>=$<span class="org-variable-name">1</span>
<span class="org-keyword">if</span> [ <span class="org-negation-char">!</span> -r <span class="org-string">"$FILE_SRC_ORIG"</span> ]; <span class="org-keyword">then</span>
    die <span class="org-string">"Cannot read file $FILE_SRC_ORIG"</span>
<span class="org-keyword">fi</span>

<span class="org-variable-name">FILE_SRC_UPDT</span>=<span class="org-string">"${FILE_SRC_ORIG%.*}.orgmk"</span> <span class="org-comment-delimiter"># </span><span class="org-comment">replace extension</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">The temporary file only differ by its extension (`.orgmk'), so that the</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">exported file will be named &lt;orig file name&gt;.&lt;backend ext&gt;.</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-shell"><span class="org-variable-name">FILE_LOG</span>=<span class="org-string">"${FILE_SRC_ORIG%.*}.log"</span>
rm -f $<span class="org-variable-name">FILE_LOG</span>
</pre>
</div>

<p>
If the PDF file isn&rsquo;t produced (for example, because of an <i>undefined control
sequence</i>), there is no PDF file anymore; hence, <code>orgmk</code> would ignore the source
file in future calls, and the PDF file (now, missing&#x2026;) would completely
disappear from the user attention.
</p>

<p>
To avoid that, we must make a backup of the target file before the export, and
put it back if there is no target file produced.
</p>

<div class="org-src-container">

<pre class="src src-shell"><span class="org-variable-name">FILE_TARGET</span>=<span class="org-string">"${FILE_SRC_ORIG%.*}.$TARGET_EXT"</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">back up previous version of target file</span>
<span class="org-keyword">if</span> [ -r $<span class="org-variable-name">FILE_TARGET</span> ]; <span class="org-keyword">then</span>
    mv $<span class="org-variable-name">FILE_TARGET</span> $<span class="org-variable-name">FILE_TARGET</span>.orig
<span class="org-keyword">fi</span>
</pre>
</div>

<p>
Note that, like with the <code>patch</code> command, the original file is saved with the
<code>.orig</code> extension.
</p>

<div class="org-src-container">

<pre class="src src-shell"><span class="org-variable-name">EMACS</span>=emacs

<span class="org-variable-name">WHICH_EMACS</span>=$(<span class="org-builtin">which</span> $<span class="org-variable-name">EMACS</span>)
<span class="org-variable-name">EMACS_FLAGS</span>=<span class="org-string">"--eval \"(progn (message \\\"Launching $WHICH_EMACS...\\\") (message \\\"Emacs %s (%s)\\\" emacs-version system-type))\""</span>
<span class="org-variable-name">EMACS_BATCH</span>=<span class="org-string">"emacs --batch -Q $EMACS_FLAGS"</span>
<span class="org-variable-name">ORG_FLAGS</span>=<span class="org-string">""</span>
<span class="org-variable-name">ORGMK</span>=<span class="org-string">"$EMACS_BATCH $ORG_FLAGS --eval \"(message \\\"Loading ${ORGMK_EL}...\\\")\" -l $ORGMK_EL"</span>
<span class="org-variable-name">ORGMK_UPDATE_FLAGS</span>=<span class="org-string">"-f org-update-all-dblocks -f org-table-iterate-buffer-tables --eval \"(write-file \\\"${FILE_SRC_UPDT##*/}\\\")\""</span> <span class="org-comment-delimiter"># </span><span class="org-comment">base name</span>
</pre>
</div>

<div class="note">
<p>
<b>Batch option</b> <br  />
Font Lock mode is disabled by default in batch mode.  That generates errors with
some Java code blocks.  Hence, one workaround, in that case, is to call Emacs
without batch mode (and, then, to add <code>-f kill-emacs</code>, or simply <code>--kill</code>, at the
end of the command line).
</p>

</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline26" class="outline-4">
<h4 id="orgheadline26"><span class="section-number-4">1.7.2</span> org2html</h4>
<div class="outline-text-4" id="text-1-7-2">
<p>
The <code>org2html</code> script converts an Org file to HTML.
</p>

<div class="org-src-container">

<pre class="src src-shell"><span class="org-variable-name">TARGET_EXT</span>=html
. orgmk-init

<span class="org-keyword">case</span> $<span class="org-variable-name">BODY_ONLY</span><span class="org-keyword"> in</span>
    <span class="org-string">"yes"</span>)
        <span class="org-builtin">eval</span> $<span class="org-variable-name">ORGMK</span> $<span class="org-variable-name">FILE_SRC_ORIG</span> $<span class="org-variable-name">ORGMK_UPDATE_FLAGS</span> -f org-html-export-body-only-to-html <span class="org-sh-escaped-newline">\</span>
            || die <span class="org-string">"Exported file wasn't produced"</span>
        ;;
    <span class="org-string">"no"</span>)
        <span class="org-builtin">eval</span> $<span class="org-variable-name">ORGMK</span> $<span class="org-variable-name">FILE_SRC_ORIG</span> $<span class="org-variable-name">ORGMK_UPDATE_FLAGS</span> -f org-html-export-to-html <span class="org-sh-escaped-newline">\</span>
            || die <span class="org-string">"Exported file wasn't produced"</span>
<span class="org-keyword">esac</span>

orgmk-update-src-check-diff <span class="org-string">"$FILE_SRC_ORIG"</span> <span class="org-string">"$FILE_SRC_UPDT"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline27" class="outline-4">
<h4 id="orgheadline27"><span class="section-number-4">1.7.3</span> org2latex</h4>
<div class="outline-text-4" id="text-1-7-3">
<p>
The <code>org2latex</code> script converts an Org file to LaTeX.
</p>

<div class="org-src-container">

<pre class="src src-shell"><span class="org-variable-name">TARGET_EXT</span>=tex
. orgmk-init

<span class="org-keyword">case</span> $<span class="org-variable-name">BODY_ONLY</span><span class="org-keyword"> in</span>
    <span class="org-string">"yes"</span>)
        <span class="org-builtin">eval</span> $<span class="org-variable-name">ORGMK</span> $<span class="org-variable-name">FILE_SRC_ORIG</span> $<span class="org-variable-name">ORGMK_UPDATE_FLAGS</span> -f org-latex-export-body-only-to-latex <span class="org-sh-escaped-newline">\</span>
            || die <span class="org-string">"Exported file wasn't produced"</span>
        ;;
    <span class="org-string">"no"</span>)
        <span class="org-builtin">eval</span> $<span class="org-variable-name">ORGMK</span> $<span class="org-variable-name">FILE_SRC_ORIG</span> $<span class="org-variable-name">ORGMK_UPDATE_FLAGS</span> -f org-latex-export-to-latex <span class="org-sh-escaped-newline">\</span>
            || die <span class="org-string">"Exported file wasn't produced"</span>
<span class="org-keyword">esac</span>

orgmk-update-src-check-diff <span class="org-string">"$FILE_SRC_ORIG"</span> <span class="org-string">"$FILE_SRC_UPDT"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline28" class="outline-4">
<h4 id="orgheadline28"><span class="section-number-4">1.7.4</span> org2pdf</h4>
<div class="outline-text-4" id="text-1-7-4">
<p>
The <code>org2pdf</code> script converts an Org file to PDF.
</p>

<div class="note">
<p>
It tries to detect whether the target is a standard LaTeX document or a Beamer
presentation by searching for the string <code>#+BEAMER_THEME:</code> inside the Org source.
</p>

</div>

<div class="org-src-container">

<pre class="src src-shell"><span class="org-variable-name">TARGET_EXT</span>=pdf
. orgmk-init

<span class="org-keyword">if</span> grep -E <span class="org-string">"^#\+BEAMER_THEME: "</span> $<span class="org-variable-name">FILE_SRC_ORIG</span> &gt; /dev/null; <span class="org-keyword">then</span>
    <span class="org-builtin">eval</span> $<span class="org-variable-name">ORGMK</span> $<span class="org-variable-name">FILE_SRC_ORIG</span> $<span class="org-variable-name">ORGMK_UPDATE_FLAGS</span> -f org-beamer-export-to-latex <span class="org-sh-escaped-newline">\</span>
        || die <span class="org-string">"Exported file wasn't produced"</span>
<span class="org-keyword">else</span>
    <span class="org-builtin">eval</span> $<span class="org-variable-name">ORGMK</span> $<span class="org-variable-name">FILE_SRC_ORIG</span> $<span class="org-variable-name">ORGMK_UPDATE_FLAGS</span> -f org-latex-export-to-latex <span class="org-sh-escaped-newline">\</span>
        || die <span class="org-string">"Exported file wasn't produced"</span>
<span class="org-keyword">fi</span>
orgmk-update-src-check-diff <span class="org-string">"$FILE_SRC_ORIG"</span> <span class="org-string">"$FILE_SRC_UPDT"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline29" class="outline-4">
<h4 id="orgheadline29"><span class="section-number-4">1.7.5</span> org2beamerpdf</h4>
<div class="outline-text-4" id="text-1-7-5">
<p>
The <code>org2beamerpdf</code> script converts an Org file to a Beamer presentation (PDF).
</p>

<div class="org-src-container">

<pre class="src src-shell"><span class="org-variable-name">TARGET_EXT</span>=pdf
. orgmk-init

<span class="org-builtin">eval</span> $<span class="org-variable-name">ORGMK</span> $<span class="org-variable-name">FILE_SRC_ORIG</span> $<span class="org-variable-name">ORGMK_UPDATE_FLAGS</span> -f org-beamer-export-to-pdf <span class="org-sh-escaped-newline">\</span>
    || die <span class="org-string">"Exported file wasn't produced"</span>
orgmk-update-src-check-diff <span class="org-string">"$FILE_SRC_ORIG"</span> <span class="org-string">"$FILE_SRC_UPDT"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline30" class="outline-4">
<h4 id="orgheadline30"><span class="section-number-4">1.7.6</span> org2odt</h4>
<div class="outline-text-4" id="text-1-7-6">
<p>
The <code>org2odt</code> script converts an Org file to ODT.
</p>

<div class="org-src-container">

<pre class="src src-shell"><span class="org-variable-name">TARGET_EXT</span>=odt
. orgmk-init

<span class="org-builtin">eval</span> $<span class="org-variable-name">ORGMK</span> $<span class="org-variable-name">FILE_SRC_ORIG</span> $<span class="org-variable-name">ORGMK_UPDATE_FLAGS</span> -f org-odt-export-to-odt <span class="org-sh-escaped-newline">\</span>
    || die <span class="org-string">"Exported file wasn't produced"</span>
orgmk-update-src-check-diff <span class="org-string">"$FILE_SRC_ORIG"</span> <span class="org-string">"$FILE_SRC_UPDT"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline31" class="outline-4">
<h4 id="orgheadline31"><span class="section-number-4">1.7.7</span> org2txt</h4>
<div class="outline-text-4" id="text-1-7-7">
<p>
The <code>org2txt</code> script converts an Org file to text.
</p>

<div class="org-src-container">

<pre class="src src-shell"><span class="org-variable-name">TARGET_EXT</span>=txt
. orgmk-init

<span class="org-builtin">eval</span> $<span class="org-variable-name">ORGMK</span> $<span class="org-variable-name">FILE_SRC_ORIG</span> $<span class="org-variable-name">ORGMK_UPDATE_FLAGS</span> -f org-ascii-export-to-ascii <span class="org-sh-escaped-newline">\</span>
    || die <span class="org-string">"Exported file wasn't produced"</span>
orgmk-update-src-check-diff <span class="org-string">"$FILE_SRC_ORIG"</span> <span class="org-string">"$FILE_SRC_UPDT"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline34" class="outline-4">
<h4 id="orgheadline34"><span class="section-number-4">1.7.8</span> Orgmk-update-src-check-diff</h4>
<div class="outline-text-4" id="text-1-7-8">
<p>
Check whether dynamic blocks and tables have been updated, and (if yes) propose
to overwrite the source Org file.
</p>
</div>

<div id="outline-container-orgheadline32" class="outline-5">
<h5 id="orgheadline32">Functions</h5>
<div class="outline-text-5" id="text-orgheadline32">
<div class="org-src-container">

<pre class="src src-shell"><span class="org-function-name">ask</span> () {
    <span class="org-keyword">while </span><span class="org-builtin">true</span>; <span class="org-keyword">do</span>
        <span class="org-keyword">if</span> [ <span class="org-string">"${2:-}"</span> = <span class="org-string">"Y"</span> ]; <span class="org-keyword">then</span>
            <span class="org-variable-name">prompt</span>=<span class="org-string">"Y/n"</span>
            <span class="org-variable-name">default</span>=Y
        <span class="org-keyword">elif</span> [ <span class="org-string">"${2:-}"</span> = <span class="org-string">"N"</span> ]; <span class="org-keyword">then</span>
            <span class="org-variable-name">prompt</span>=<span class="org-string">"y/N"</span>
            <span class="org-variable-name">default</span>=N
        <span class="org-keyword">else</span>
            <span class="org-variable-name">prompt</span>=<span class="org-string">"y/n"</span>
            <span class="org-variable-name">default</span>=
        <span class="org-keyword">fi</span>

        <span class="org-comment-delimiter"># </span><span class="org-comment">ask the question (without the need to press RET)</span>
        printf <span class="org-string">"$1 ($prompt): "</span>
        <span class="org-builtin">read</span> -n 1 -r REPLY
        printf <span class="org-string">"\n"</span> <span class="org-comment-delimiter"># </span><span class="org-comment">just a final linefeed</span>

        <span class="org-comment-delimiter"># </span><span class="org-comment">default?</span>
        <span class="org-keyword">if</span> [ -z <span class="org-string">"$REPLY"</span> ]; <span class="org-keyword">then</span>
            <span class="org-variable-name">REPLY</span>=$<span class="org-variable-name">default</span>
        <span class="org-keyword">fi</span>

        <span class="org-comment-delimiter"># </span><span class="org-comment">check if the reply is valid</span>
        <span class="org-keyword">case</span> <span class="org-string">"$REPLY"</span><span class="org-keyword"> in</span>
            y*|Y*) <span class="org-keyword">return</span> 0 ;;
            n*|N*) <span class="org-keyword">return</span> 1 ;;
        <span class="org-keyword">esac</span>
    <span class="org-keyword">done</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline33" class="outline-5">
<h5 id="orgheadline33">Runtime</h5>
<div class="outline-text-5" id="text-orgheadline33">
<div class="org-src-container">

<pre class="src src-shell"><span class="org-variable-name">FILE_SRC_ORIG</span>=$<span class="org-variable-name">1</span>
<span class="org-variable-name">FILE_SRC_UPDT</span>=$<span class="org-variable-name">2</span>

<span class="org-comment-delimiter"># </span><span class="org-comment">set a default value</span>
: ${<span class="org-variable-name">UPDATE_SRC</span>:=<span class="org-string">"query"</span>}

<span class="org-keyword">if</span> [ <span class="org-negation-char">!</span> -r <span class="org-string">"$FILE_SRC_UPDT"</span> ]; <span class="org-keyword">then</span>
    printf <span class="org-string">"Cannot read file $FILE_SRC_UPDT\n"</span>
<span class="org-keyword">else</span>
    <span class="org-keyword">if</span> diff -q <span class="org-string">"$FILE_SRC_ORIG"</span> <span class="org-string">"$FILE_SRC_UPDT"</span> &gt; /dev/null; <span class="org-keyword">then</span>
        rm <span class="org-string">"$FILE_SRC_UPDT"</span>
    <span class="org-keyword">else</span>
        <span class="org-keyword">if</span> [[ <span class="org-string">"$UPDATE_SRC"</span> = <span class="org-string">"query"</span> ]]; <span class="org-keyword">then</span>
            ask <span class="org-string">"Update source file?"</span> &amp;&amp; <span class="org-variable-name">UPDATE_SRC</span>=<span class="org-string">"yes"</span> || <span class="org-variable-name">UPDATE_SRC</span>=<span class="org-string">"no"</span>
        <span class="org-keyword">fi</span>

        <span class="org-keyword">if</span> [[ <span class="org-string">"$UPDATE_SRC"</span> = <span class="org-string">"yes"</span> ]]; <span class="org-keyword">then</span>
            mv <span class="org-string">"$FILE_SRC_UPDT"</span> <span class="org-string">"$FILE_SRC_ORIG"</span>
            printf <span class="org-string">"${C_INFO}Dynamic blocks and tables in \`$FILE_SRC_ORIG' successfully updated${C_RESET}\n"</span>
        <span class="org-keyword">else</span>
            printf <span class="org-string">"Nothing gets updated...\n"</span>
        <span class="org-keyword">fi</span>
    <span class="org-keyword">fi</span>
<span class="org-keyword">fi</span>
</pre>
</div>

<p>
In order to avoid &ldquo;file changed on disk&rdquo; messages (and be forced to revert
open buffers) when nothing changed, we save the file with another name, and
diff it with the original file. If there is no change, the new file is
dropped.
</p>

<div class="note">
<p>
The time stamps in &ldquo;Clock summary at &#x2026;&rdquo; will be different, each time dynamic
blocks are updated (if not done during the same minute). In that case, <code>diff</code>
will always &ldquo;succeed&rdquo;.
</p>

</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline35" class="outline-4">
<h4 id="orgheadline35"><span class="section-number-4">1.7.9</span> org-tangle</h4>
<div class="outline-text-4" id="text-1-7-9">
<p>
The <code>org-tangle</code> tangles an Org file.
</p>

<div class="org-src-container">

<pre class="src src-shell"><span class="org-variable-name">TARGET_EXT</span>=
. orgmk-init

<span class="org-builtin">eval</span> $<span class="org-variable-name">ORGMK</span> $<span class="org-variable-name">FILE_SRC_ORIG</span> $<span class="org-variable-name">ORGMK_UPDATE_FLAGS</span> -f org-babel-tangle <span class="org-sh-escaped-newline">\</span>
    || die <span class="org-string">"File wasn't tangled"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline57" class="outline-3">
<h3 id="orgheadline57"><span class="section-number-3">1.8</span> Orgmk</h3>
<div class="outline-text-3" id="text-1-8">
</div><div id="outline-container-orgheadline55" class="outline-4">
<h4 id="orgheadline55"><span class="section-number-4">1.8.1</span> Orgmk.mk</h4>
<div class="outline-text-4" id="text-1-8-1">
<p>
Here is the &ldquo;ultimate&rdquo; Makefile to <b>automate the generation of HTML or PDF</b>
versions from your Org mode files.
</p>

<p>
It is designed to solve tedious tasks nicely, such as updating:
</p>

<ul class="org-ul">
<li class="on">&#x2611; table of contents,</li>
<li class="on">&#x2611; cross-references,</li>
<li class="off">&#x2610; index,</li>
<li class="off">&#x2610; list of figures,</li>
<li class="off">&#x2610; BibTeX references,</li>
<li class="on">&#x2611; Org dynamic blocks,</li>
<li class="on">&#x2611; tables with formulas, and</li>
<li class="off">&#x2610; <p>
extracting (tangle) code blocks.
</p>

<div class="inlinetask">
<b><span class="todo TODO">TODO</span> Test whether Orgmk works with symbolic links</b><br  />
<p>
Does their modification time change to reflect the latest modification of the
source?
</p>
</div></li>
</ul>
</div>

<div id="outline-container-orgheadline37" class="outline-5">
<h5 id="orgheadline37">Some system-dependent stuff</h5>
<div class="outline-text-5" id="text-orgheadline37">
<div class="org-src-container">

<pre class="src src-makefile"><span class="org-comment-delimiter">### </span><span class="org-comment">-*- Makefile -*- definition file for Orgmk</span>
</pre>
</div>
</div>

<ul class="org-ul"><li><a id="orgheadline38"></a>Default shell<br  /><div class="outline-text-6" id="text-orgheadline38">
<div class="org-src-container">

<pre class="src src-makefile"><span class="org-variable-name">SHELL</span> = /bin/sh
</pre>
</div>
</div></li>

<li><a id="orgheadline39"></a>Exportation scripts<br  /><div class="outline-text-6" id="text-orgheadline39">
<p>
By default, the <code>orgmk.mk</code> will overwrite the Org source file if it has changed
after dblocks update and tables re-computation.
</p>

<div class="org-src-container">

<pre class="src src-makefile"><span class="org-variable-name">ORG2_FLAGS</span>=-y

<span class="org-variable-name">ORG2HTML</span>=org2html $(<span class="org-variable-name">ORG2_FLAGS</span>)
<span class="org-variable-name">ORG2PDF</span>=org2pdf $(<span class="org-variable-name">ORG2_FLAGS</span>)
</pre>
</div>
</div></li>

<li><a id="orgheadline40"></a>Viewing stuff<br  /><div class="outline-text-6" id="text-orgheadline40">
<div class="org-src-container">

<pre class="src src-makefile"><span class="org-variable-name">VIEW_HTML</span> ?= firefox
<span class="org-variable-name">VIEW_PDF</span> ?= xpdf
</pre>
</div>
</div></li>

<li><a id="orgheadline41"></a>Color output<br  /><div class="outline-text-6" id="text-orgheadline41">
<div class="org-src-container">

<pre class="src src-makefile">ifdef NO_COLOR
    <span class="org-variable-name">tput</span> =
else
    <span class="org-variable-name">tput</span> = $(<span class="org-variable-name">shell</span> $(<span class="org-variable-name">TPUT</span>) $<span class="org-constant">1</span>)
endif

<span class="org-variable-name">black</span><span class="org-whitespace-tab">   </span>:= $(<span class="org-variable-name">call</span> tput,setaf 0)
<span class="org-variable-name">red</span><span class="org-whitespace-tab">     </span>:= $(<span class="org-variable-name">call</span> tput,setaf 1)
<span class="org-variable-name">green</span><span class="org-whitespace-tab">   </span>:= $(<span class="org-variable-name">call</span> tput,setaf 2)
<span class="org-variable-name">yellow</span><span class="org-whitespace-tab">  </span>:= $(<span class="org-variable-name">call</span> tput,setaf 3)
<span class="org-variable-name">blue</span><span class="org-whitespace-tab">    </span>:= $(<span class="org-variable-name">call</span> tput,setaf 4)
<span class="org-variable-name">magenta</span><span class="org-whitespace-tab"> </span>:= $(<span class="org-variable-name">call</span> tput,setaf 5)
<span class="org-variable-name">cyan</span><span class="org-whitespace-tab">    </span>:= $(<span class="org-variable-name">call</span> tput,setaf 6)
<span class="org-variable-name">white</span><span class="org-whitespace-tab">   </span>:= $(<span class="org-variable-name">call</span> tput,setaf 7)
<span class="org-variable-name">bold</span><span class="org-whitespace-tab">    </span>:= $(<span class="org-variable-name">call</span> tput,bold)
<span class="org-variable-name">uline</span><span class="org-whitespace-tab">   </span>:= $(<span class="org-variable-name">call</span> tput,smul)
<span class="org-variable-name">reset</span><span class="org-whitespace-tab">   </span>:= $(<span class="org-variable-name">call</span> tput,sgr0)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-makefile"><span class="org-variable-name">C_INFO</span>=<span class="org-string">"\\e[32m"</span>
<span class="org-variable-name">C_WARNING</span>=<span class="org-string">"\\e[35m"</span>
<span class="org-variable-name">C_SUCCESS</span>=<span class="org-string">"\\e[1\;32m"</span>
<span class="org-variable-name">C_FAILURE</span>=<span class="org-string">"\\e[1\;31m"</span>
<span class="org-variable-name">C_RESET</span>=<span class="org-string">"\\e[0m"</span>
</pre>
</div>
</div></li></ul>
</div>

<div id="outline-container-orgheadline47" class="outline-5">
<h5 id="orgheadline47">Basic configuration</h5>
<div class="outline-text-5" id="text-orgheadline47">
</div><ul class="org-ul"><li><a id="orgheadline42"></a>Org Sources<br  /><div class="outline-text-6" id="text-orgheadline42">
<p>
Discover and process all Org files in the current directory (or in the current
subtree).
</p>

<div class="org-src-container">

<pre class="src src-makefile">ifeq ($(<span class="org-variable-name">ALLSUBDIRS</span>),yes)
    <span class="org-variable-name">TXT_FILES</span>=$(<span class="org-variable-name">shell</span> find . -name \*.txt)
    <span class="org-variable-name">ORG_FILES</span>=$(<span class="org-variable-name">shell</span> find . -name \*.org)
    <span class="org-variable-name">HTML_FILES</span>=$(<span class="org-variable-name">shell</span> find . -name \*.html)
    <span class="org-variable-name">PDF_FILES</span>=$(<span class="org-variable-name">shell</span> find . -name \*.pdf)
else
    <span class="org-variable-name">TXT_FILES</span>=$(<span class="org-variable-name">shell</span> find . -maxdepth 1 -name \*.txt)
    <span class="org-variable-name">ORG_FILES</span>=$(<span class="org-variable-name">shell</span> find . -maxdepth 1 -name \*.org)
    <span class="org-variable-name">HTML_FILES</span>=$(<span class="org-variable-name">shell</span> find . -maxdepth 1 -name \*.html)
    <span class="org-variable-name">PDF_FILES</span>=$(<span class="org-variable-name">shell</span> find . -maxdepth 1 -name \*.pdf)
endif

<span class="org-variable-name">FILES_TO_TANGLE</span> := $(<span class="org-variable-name">join</span> $(<span class="org-variable-name">ORG_FILES</span>), $(<span class="org-variable-name">TXT_FILES</span>))
</pre>
</div>

<div class="inlinetask">
<b><span class="todo TODO">TODO</span> Add Org_DIRS defaulting to .</b><br  />
<p>
Use Org_DIRS with foreach (?) in the following lists
</p>
</div>

<div class="inlinetask">
<b><span class="todo TODO">TODO</span> Fix problem of Orgfile with .org/.txt extension</b><br  />
<p>
If an Org file exists with the 2 file extensions <code>.txt</code> and <code>.org</code> (same base
name), then we get messages such as:
</p>

<p>
Makefile:102: warning: overriding recipe for target `plot.html&rsquo;
Makefile:89: warning: ignoring old recipe for target `plot.html&rsquo;
</p>
</div>
</div></li>

<li><a id="orgheadline43"></a>HTML Targets<br  /><div class="outline-text-6" id="text-orgheadline43">
<p>
List of HTML files which can be generated:
</p>

<div class="org-src-container">

<pre class="src src-makefile"><span class="org-variable-name">HTML_FILES_FROM_ORG</span> = $(<span class="org-variable-name">patsubst</span> %.org,%.html,$(<span class="org-variable-name">ORG_FILES</span>))
<span class="org-variable-name">HTML_FILES_FROM_TXT</span> = $(<span class="org-variable-name">patsubst</span> %.txt,%.html,$(<span class="org-variable-name">TXT_FILES</span>))
</pre>
</div>

<p>
List of HTML files to be re-generated (if they have an Org counterpart):
</p>

<div class="org-src-container">

<pre class="src src-makefile"><span class="org-variable-name">CUR_HTML_FILES</span> := $(<span class="org-variable-name">HTML_FILES</span>)
</pre>
</div>
</div></li>

<li><a id="orgheadline44"></a>PDF Targets<br  /><div class="outline-text-6" id="text-orgheadline44">
<p>
List of PDF files which can be generated:
</p>

<div class="org-src-container">

<pre class="src src-makefile"><span class="org-variable-name">PDF_FILES_FROM_ORG</span> = $(<span class="org-variable-name">patsubst</span> %.org,%.pdf,$(<span class="org-variable-name">ORG_FILES</span>))
<span class="org-variable-name">PDF_FILES_FROM_TXT</span> = $(<span class="org-variable-name">patsubst</span> %.txt,%.pdf,$(<span class="org-variable-name">TXT_FILES</span>))
</pre>
</div>

<p>
List of PDF files to be re-generated (if they have an Org counterpart):
</p>

<div class="org-src-container">

<pre class="src src-makefile"><span class="org-variable-name">CUR_PDF_FILES</span> := $(<span class="org-variable-name">PDF_FILES</span>)
</pre>
</div>
</div></li>

<li><a id="orgheadline45"></a>Debugging<br  /><div class="outline-text-6" id="text-orgheadline45">
<div class="org-src-container">

<pre class="src src-makefile"><span class="org-comment-delimiter"># </span><span class="org-comment">turn command echo'ing back on with VERBOSE=1</span>
ifndef VERBOSE
    <span class="org-variable-name">QUIET</span> := @
endif
</pre>
</div>

<p>
<b>Everything</b> is echo&rsquo;ed, even <code>$(shell ...)</code> invocations:
</p>

<div class="org-src-container">

<pre class="src src-makefile"><span class="org-comment-delimiter"># </span><span class="org-comment">turn on shell debugging with SHELL_DE</span><span class="org-leuven-highlight"><span class="org-comment">BUG</span></span><span class="org-comment">=1</span>
ifdef SHELL_DE<span class="org-leuven-highlight">BUG</span>
    <span class="org-variable-name">SHELL</span> += -x
endif
</pre>
</div>
</div></li>

<li><a id="orgheadline46"></a>Commands<br  /><div class="outline-text-6" id="text-orgheadline46">
<p>
Define variables for each command used in targets:
</p>

<div class="org-src-container">

<pre class="src src-makefile"><span class="org-variable-name">PRINTF</span>=$(<span class="org-variable-name">QUIET</span>)printf
<span class="org-variable-name">EGREP</span>=$(<span class="org-variable-name">QUIET</span>)egrep
<span class="org-variable-name">LS</span>=$(<span class="org-variable-name">QUIET</span>)ls
</pre>
</div>
</div></li></ul>
</div>

<div id="outline-container-orgheadline48" class="outline-5">
<h5 id="orgheadline48">All</h5>
<div class="outline-text-5" id="text-orgheadline48">
<div class="org-src-container">

<pre class="src src-makefile"><span class="org-makefile-targets">.PHONY</span>: all
<span class="org-makefile-targets">all</span>: html pdf                           <span class="org-comment-delimiter"># </span><span class="org-comment">Regenerate all HTML and PDF files</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline49" class="outline-5">
<h5 id="orgheadline49">Help</h5>
<div class="outline-text-5" id="text-orgheadline49">
<p>
Get help.
</p>

<div class="org-src-container">

<pre class="src src-makefile"><span class="org-makefile-targets">.PHONY</span>: help
<span class="org-makefile-targets">help</span>:                                   <span class="org-comment-delimiter"># </span><span class="org-comment">Display callable targets</span>
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">PRINTF</span>) <span class="org-string">"Usage: orgmk [OPTION]... [TARGET]...\n"</span> &gt; /dev/stderr
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">PRINTF</span>) <span class="org-string">"\n"</span>
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">PRINTF</span>) <span class="org-string">"What target do you want?\n"</span> &gt; /dev/stderr
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">EGREP</span>) <span class="org-string">"^[^</span><span class="org-whitespace-tab">   </span><span class="org-string">#A-Z]+:"</span> [Mm]akefile \
<span class="org-whitespace-tab">        </span>| sed <span class="org-string">'s/:[^#]*//'</span> | sed <span class="org-string">'s/^/\n/g'</span> | sed <span class="org-string">'s/# /\n\t/g'</span> &gt; /dev/stderr
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline50" class="outline-5">
<h5 id="orgheadline50">HTML</h5>
<div class="outline-text-5" id="text-orgheadline50">
<p>
<code>orgmk html</code> will regenerate all HTML files which <b>currently exist</b> in the
directory, and whose source Org file has changed.
</p>

<div class="org-src-container">

<pre class="src src-makefile"><span class="org-makefile-targets">.PHONY</span>: html
<span class="org-makefile-targets">html</span>: $(<span class="org-variable-name">CUR_HTML_FILES</span>)                 <span class="org-comment-delimiter"># </span><span class="org-comment">Regenerate all HTML documents from Org</span>
</pre>
</div>

<p>
To create an HTML file for the <b>first time</b>, type <code>orgmk file.html</code>. It will
ignore other Org files in the directory.
</p>

<div class="org-src-container">

<pre class="src src-makefile"><span class="org-makefile-targets">$(HTML_FILES_FROM_ORG)</span>: %.html: %.org   <span class="org-comment-delimiter"># </span><span class="org-comment">Export an Org document to HTML</span>
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">PRINTF</span>) <span class="org-string">"$(</span><span class="org-variable-name"><span class="org-string">C_INFO</span></span><span class="org-string">)Exporting \`$(</span><span class="org-variable-name"><span class="org-string">CURDIR</span></span><span class="org-string">)/$</span><span class="org-constant"><span class="org-string">&lt;</span></span><span class="org-string">' to HTML...$(</span><span class="org-variable-name"><span class="org-string">C_RESET</span></span><span class="org-string">)\n"</span>
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">ORG2HTML</span>) $<span class="org-constant">&lt;</span>
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">LS</span>) -l -t $<span class="org-constant">&lt;</span> <span class="org-makefile-targets">$</span><span class="org-constant"><span class="org-makefile-targets">@</span></span> | head -n 1 | grep -E <span class="org-string">"\.html"</span> &gt; /dev/null \
<span class="org-whitespace-tab">        </span>|| { printf <span class="org-string">"$(</span><span class="org-variable-name"><span class="org-string">C_FAILURE</span></span><span class="org-string">)\`$(</span><span class="org-variable-name"><span class="org-string">CURDIR</span></span><span class="org-string">)/</span><span class="org-string"><span class="org-makefile-targets">$</span></span><span class="org-constant"><span class="org-string"><span class="org-makefile-targets">@</span></span></span><span class="org-string">' is NOT up to date$(</span><span class="org-variable-name"><span class="org-string">C_RESET</span></span><span class="org-string">)\n"</span>; exit 1; }
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">PRINTF</span>) <span class="org-string">"$(</span><span class="org-variable-name"><span class="org-string">C_SUCCESS</span></span><span class="org-string">)\`$(</span><span class="org-variable-name"><span class="org-string">CURDIR</span></span><span class="org-string">)/</span><span class="org-string"><span class="org-makefile-targets">$</span></span><span class="org-constant"><span class="org-string"><span class="org-makefile-targets">@</span></span></span><span class="org-string">' successfully generated$(</span><span class="org-variable-name"><span class="org-string">C_RESET</span></span><span class="org-string">)\n"</span>

<span class="org-makefile-targets">$(</span><span class="org-makefile-targets"><span class="org-variable-name">HTML_FILES_FROM_TXT</span></span><span class="org-makefile-targets">)</span>: %.html: %.txt   <span class="org-comment-delimiter"># </span><span class="org-comment">Export an Org document to HTML</span>
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">PRINTF</span>) <span class="org-string">"$(</span><span class="org-variable-name"><span class="org-string">C_INFO</span></span><span class="org-string">)Exporting \`$(</span><span class="org-variable-name"><span class="org-string">CURDIR</span></span><span class="org-string">)/$</span><span class="org-constant"><span class="org-string">&lt;</span></span><span class="org-string">' to HTML...$(</span><span class="org-variable-name"><span class="org-string">C_RESET</span></span><span class="org-string">)\n"</span>
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">ORG2HTML</span>) $<span class="org-constant">&lt;</span>
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">LS</span>) -l -t $<span class="org-constant">&lt;</span> <span class="org-makefile-targets">$</span><span class="org-constant"><span class="org-makefile-targets">@</span></span> | head -n 1 | grep -E <span class="org-string">"\.html"</span> &gt; /dev/null \
<span class="org-whitespace-tab">        </span>|| { printf <span class="org-string">"$(</span><span class="org-variable-name"><span class="org-string">C_FAILURE</span></span><span class="org-string">)\`$(</span><span class="org-variable-name"><span class="org-string">CURDIR</span></span><span class="org-string">)/</span><span class="org-string"><span class="org-makefile-targets">$</span></span><span class="org-constant"><span class="org-string"><span class="org-makefile-targets">@</span></span></span><span class="org-string">' is NOT up to date$(</span><span class="org-variable-name"><span class="org-string">C_RESET</span></span><span class="org-string">)\n"</span>; exit 1; }
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">PRINTF</span>) <span class="org-string">"$(</span><span class="org-variable-name"><span class="org-string">C_SUCCESS</span></span><span class="org-string">)\`$(</span><span class="org-variable-name"><span class="org-string">CURDIR</span></span><span class="org-string">)/</span><span class="org-string"><span class="org-makefile-targets">$</span></span><span class="org-constant"><span class="org-string"><span class="org-makefile-targets">@</span></span></span><span class="org-string">' successfully generated$(</span><span class="org-variable-name"><span class="org-string">C_RESET</span></span><span class="org-string">)\n"</span>
</pre>
</div>

<p>
The recipe to <b>convert Org to HTML</b> is:
</p>

<div class="org-src-container">

<pre class="src src-makefile" id="orgsrcblock2"><span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">PRINTF</span>) <span class="org-string">"$(</span><span class="org-variable-name"><span class="org-string">C_INFO</span></span><span class="org-string">)Exporting \`$(</span><span class="org-variable-name"><span class="org-string">CURDIR</span></span><span class="org-string">)/$</span><span class="org-constant"><span class="org-string">&lt;</span></span><span class="org-string">' to HTML...$(</span><span class="org-variable-name"><span class="org-string">C_RESET</span></span><span class="org-string">)\n"</span>
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">ORG2HTML</span>) $<span class="org-constant">&lt;</span>
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">LS</span>) -l -t $<span class="org-constant">&lt;</span> <span class="org-makefile-targets">$</span><span class="org-constant"><span class="org-makefile-targets">@</span></span> | head -n 1 | grep -E <span class="org-string">"\.html"</span> &gt; /dev/null \
<span class="org-whitespace-tab">        </span>|| { printf <span class="org-string">"$(</span><span class="org-variable-name"><span class="org-string">C_FAILURE</span></span><span class="org-string">)\`$(</span><span class="org-variable-name"><span class="org-string">CURDIR</span></span><span class="org-string">)/</span><span class="org-string"><span class="org-makefile-targets">$</span></span><span class="org-constant"><span class="org-string"><span class="org-makefile-targets">@</span></span></span><span class="org-string">' is NOT up to date$(</span><span class="org-variable-name"><span class="org-string">C_RESET</span></span><span class="org-string">)\n"</span>; exit 1; }
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">PRINTF</span>) <span class="org-string">"$(</span><span class="org-variable-name"><span class="org-string">C_SUCCESS</span></span><span class="org-string">)\`$(</span><span class="org-variable-name"><span class="org-string">CURDIR</span></span><span class="org-string">)/</span><span class="org-string"><span class="org-makefile-targets">$</span></span><span class="org-constant"><span class="org-string"><span class="org-makefile-targets">@</span></span></span><span class="org-string">' successfully generated$(</span><span class="org-variable-name"><span class="org-string">C_RESET</span></span><span class="org-string">)\n"</span>
</pre>
</div>

<p>
What about <code>org-export-as-html-batch</code> and <code>org-export-as-html-and-open</code>?
</p>

<div class="org-src-container">

<pre class="src src-makefile"><span class="org-makefile-targets">view-html</span>:                              <span class="org-comment-delimiter"># </span><span class="org-comment">Generate the HTML files, then show the result</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline51" class="outline-5">
<h5 id="orgheadline51">PDF</h5>
<div class="outline-text-5" id="text-orgheadline51">
<p>
<code>orgmk pdf</code> will find out which PDF files have to be regenerated, and will
regenerate all of them.
</p>

<div class="org-src-container">

<pre class="src src-makefile"><span class="org-makefile-targets">.PHONY</span>: pdf
<span class="org-makefile-targets">pdf</span>: $(<span class="org-variable-name">CUR_PDF_FILES</span>)                   <span class="org-comment-delimiter"># </span><span class="org-comment">Regenerate all PDF documents from Org</span>
</pre>
</div>

<p>
Type <code>orgmk file.pdf</code> to generate only the specified PDF file.
</p>

<div class="org-src-container">

<pre class="src src-makefile"><span class="org-makefile-targets">$(PDF_FILES_FROM_ORG)</span>: %.pdf: %.org     <span class="org-comment-delimiter"># </span><span class="org-comment">Export an Org document to PDF</span>
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">PRINTF</span>) <span class="org-string">"$(</span><span class="org-variable-name"><span class="org-string">C_INFO</span></span><span class="org-string">)Exporting \`$(</span><span class="org-variable-name"><span class="org-string">CURDIR</span></span><span class="org-string">)/$</span><span class="org-constant"><span class="org-string">&lt;</span></span><span class="org-string">' to PDF...$(</span><span class="org-variable-name"><span class="org-string">C_RESET</span></span><span class="org-string">)\n"</span>
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">ORG2PDF</span>) $<span class="org-constant">&lt;</span>
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">LS</span>) -l -t $<span class="org-constant">&lt;</span> <span class="org-makefile-targets">$</span><span class="org-constant"><span class="org-makefile-targets">@</span></span> | head -n 1 | grep -E <span class="org-string">"\.pdf"</span> &gt; /dev/null \
<span class="org-whitespace-tab">        </span>|| { printf <span class="org-string">"$(</span><span class="org-variable-name"><span class="org-string">C_FAILURE</span></span><span class="org-string">)\`$(</span><span class="org-variable-name"><span class="org-string">CURDIR</span></span><span class="org-string">)/</span><span class="org-string"><span class="org-makefile-targets">$</span></span><span class="org-constant"><span class="org-string"><span class="org-makefile-targets">@</span></span></span><span class="org-string">' is NOT up to date$(</span><span class="org-variable-name"><span class="org-string">C_RESET</span></span><span class="org-string">)\n"</span>; exit 1; }
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">PRINTF</span>) <span class="org-string">"$(</span><span class="org-variable-name"><span class="org-string">C_SUCCESS</span></span><span class="org-string">)\`$(</span><span class="org-variable-name"><span class="org-string">CURDIR</span></span><span class="org-string">)/</span><span class="org-string"><span class="org-makefile-targets">$</span></span><span class="org-constant"><span class="org-string"><span class="org-makefile-targets">@</span></span></span><span class="org-string">' successfully generated$(</span><span class="org-variable-name"><span class="org-string">C_RESET</span></span><span class="org-string">)\n"</span>

<span class="org-makefile-targets">$(</span><span class="org-makefile-targets"><span class="org-variable-name">PDF_FILES_FROM_TXT</span></span><span class="org-makefile-targets">)</span>: %.pdf: %.txt     <span class="org-comment-delimiter"># </span><span class="org-comment">Export an Org document to PDF</span>
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">PRINTF</span>) <span class="org-string">"$(</span><span class="org-variable-name"><span class="org-string">C_INFO</span></span><span class="org-string">)Exporting \`$(</span><span class="org-variable-name"><span class="org-string">CURDIR</span></span><span class="org-string">)/$</span><span class="org-constant"><span class="org-string">&lt;</span></span><span class="org-string">' to PDF...$(</span><span class="org-variable-name"><span class="org-string">C_RESET</span></span><span class="org-string">)\n"</span>
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">ORG2PDF</span>) $<span class="org-constant">&lt;</span>
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">LS</span>) -l -t $<span class="org-constant">&lt;</span> <span class="org-makefile-targets">$</span><span class="org-constant"><span class="org-makefile-targets">@</span></span> | head -n 1 | grep -E <span class="org-string">"\.pdf"</span> &gt; /dev/null \
<span class="org-whitespace-tab">        </span>|| { printf <span class="org-string">"$(</span><span class="org-variable-name"><span class="org-string">C_FAILURE</span></span><span class="org-string">)\`$(</span><span class="org-variable-name"><span class="org-string">CURDIR</span></span><span class="org-string">)/</span><span class="org-string"><span class="org-makefile-targets">$</span></span><span class="org-constant"><span class="org-string"><span class="org-makefile-targets">@</span></span></span><span class="org-string">' is NOT up to date$(</span><span class="org-variable-name"><span class="org-string">C_RESET</span></span><span class="org-string">)\n"</span>; exit 1; }
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">PRINTF</span>) <span class="org-string">"$(</span><span class="org-variable-name"><span class="org-string">C_SUCCESS</span></span><span class="org-string">)\`$(</span><span class="org-variable-name"><span class="org-string">CURDIR</span></span><span class="org-string">)/</span><span class="org-string"><span class="org-makefile-targets">$</span></span><span class="org-constant"><span class="org-string"><span class="org-makefile-targets">@</span></span></span><span class="org-string">' successfully generated$(</span><span class="org-variable-name"><span class="org-string">C_RESET</span></span><span class="org-string">)\n"</span>
</pre>
</div>

<div class="note">
<p>
The drawback of updating the dblocks inside the the recipes for HTML and PDF
means that, if we have a file that&rsquo;s <b>converted to both file formats</b>, the
update will be done twice (so, once at least for nothing): once for HTML, then
once again for PDF. Though, this case is quite uncommon.
</p>

</div>

<p>
The recipe to <b>convert Org to PDF</b> is:
</p>

<div class="org-src-container">

<pre class="src src-makefile" id="orgsrcblock3"><span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">PRINTF</span>) <span class="org-string">"$(</span><span class="org-variable-name"><span class="org-string">C_INFO</span></span><span class="org-string">)Exporting \`$(</span><span class="org-variable-name"><span class="org-string">CURDIR</span></span><span class="org-string">)/$</span><span class="org-constant"><span class="org-string">&lt;</span></span><span class="org-string">' to PDF...$(</span><span class="org-variable-name"><span class="org-string">C_RESET</span></span><span class="org-string">)\n"</span>
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">ORG2PDF</span>) $<span class="org-constant">&lt;</span>
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">LS</span>) -l -t $<span class="org-constant">&lt;</span> <span class="org-makefile-targets">$</span><span class="org-constant"><span class="org-makefile-targets">@</span></span> | head -n 1 | grep -E <span class="org-string">"\.pdf"</span> &gt; /dev/null \
<span class="org-whitespace-tab">        </span>|| { printf <span class="org-string">"$(</span><span class="org-variable-name"><span class="org-string">C_FAILURE</span></span><span class="org-string">)\`$(</span><span class="org-variable-name"><span class="org-string">CURDIR</span></span><span class="org-string">)/</span><span class="org-string"><span class="org-makefile-targets">$</span></span><span class="org-constant"><span class="org-string"><span class="org-makefile-targets">@</span></span></span><span class="org-string">' is NOT up to date$(</span><span class="org-variable-name"><span class="org-string">C_RESET</span></span><span class="org-string">)\n"</span>; exit 1; }
<span class="org-whitespace-tab">        </span>$(<span class="org-variable-name">PRINTF</span>) <span class="org-string">"$(</span><span class="org-variable-name"><span class="org-string">C_SUCCESS</span></span><span class="org-string">)\`$(</span><span class="org-variable-name"><span class="org-string">CURDIR</span></span><span class="org-string">)/</span><span class="org-string"><span class="org-makefile-targets">$</span></span><span class="org-constant"><span class="org-string"><span class="org-makefile-targets">@</span></span></span><span class="org-string">' successfully generated$(</span><span class="org-variable-name"><span class="org-string">C_RESET</span></span><span class="org-string">)\n"</span>
</pre>
</div>

<div class="inlinetask">
<b><span class="todo TODO">TODO</span> Export as LaTeX?</b><br  />
<p>
Maybe the export should be done to TeX, and then call (the minimum number of
times) PDFLaTeX from the <code>orgmk.mk</code>? Check out if this is as robust as using Org
to build the PDF&#x2026; (which goes on, even with some errors occurring)
</p>
</div>

<p>
I&rsquo;ve observed cases where <code>orgmk pdf</code> was reporting that &ldquo;Exporting to
PDF&#x2026;done&rdquo;, but I was left with the previous PDF file. Hence, every call to
<code>orgmk</code> tried to redo them&#x2026;
</p>

<p>
On deleting the PDF, and relaunching <code>orgmk</code> on that file, I had an error
during the &ldquo;Processing LaTeX file&rdquo;.
</p>

<p>
Workaround, to be sure that an old PDF does not stay in the way, remove the
PDF output upon startup of the recipe. The TeX file was well updated. Hence,
no need to delete it at startup&#x2026;
</p>

<p>
<b>Problem</b>: when the PDF file is not generated anymore, it won&rsquo;t be remade with
<code>orgmk pdf</code>. We then have to explicitly <code>orgmk file.pdf</code>.
</p>
</div>
</div>

<div id="outline-container-orgheadline52" class="outline-5">
<h5 id="orgheadline52">Clean</h5>
<div class="outline-text-5" id="text-orgheadline52">
<div class="org-src-container">

<pre class="src src-makefile"><span class="org-makefile-targets">.PHONY</span>: clean
<span class="org-makefile-targets">clean</span>:                                  <span class="org-comment-delimiter"># </span><span class="org-comment">Delete all temporary files created by Org export</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline53" class="outline-5">
<h5 id="orgheadline53"><span class="todo TODO">TODO</span> Orgmk init file</h5>
<div class="outline-text-5" id="text-orgheadline53">
<p>
Here, we should <b>make a symlink</b>, if it does not exist yet. Would then be used
just once&#x2026;
</p>

<p>
The only thing that&rsquo;s not done yet automatically is: tangling this file!
</p>
</div>
</div>

<div id="outline-container-orgheadline54" class="outline-5">
<h5 id="orgheadline54">Footer</h5>
<div class="outline-text-5" id="text-orgheadline54">
<div class="org-src-container">

<pre class="src src-makefile"><span class="org-comment-delimiter">### </span><span class="org-comment">orgmk.mk ends here</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline56" class="outline-4">
<h4 id="orgheadline56"><span class="section-number-4">1.8.2</span> Makefile wrapper</h4>
<div class="outline-text-4" id="text-1-8-2">
<p>
As you could want to run the batch scripts from a (development) directory
where there is already a <code>Makefile</code>, you must install the <code>Makefile</code> under a
different name: <code>orgmk.mk</code>.
</p>

<p>
An addition is to create a symbolic link to the <code>orgmk.mk</code> into the
directory of your Org files just for the duration of the script execution
(on-the-fly install). The links can be safely removed after <code>make</code> has been run.
</p>

<div class="org-src-container">

<pre class="src src-shell"><span class="org-function-name">Usage</span> ()
{
    cat &lt;&lt; EOF 1&gt;&amp;2
<span class="org-sh-heredoc">Usage: $(basename $0) [OPTION] FILE</span>
<span class="org-sh-heredoc">Export Org source files whenever they are updated.</span>

<span class="org-sh-heredoc">  -h, --help          display this help and exit</span>
<span class="org-sh-heredoc">  -r, --recursive     export all Org files under each directory, recursively</span>

<span class="org-sh-heredoc">Report $(basename $0) bugs to fni@missioncriticalit.com</span>
<span class="org-sh-heredoc">EOF</span>
    <span class="org-keyword">exit</span> 1
}
</pre>
</div>

<div class="org-src-container">

<pre class="src src-shell"><span class="org-function-name">CleanUp</span> ()
{
    <span class="org-comment-delimiter"># </span><span class="org-comment">remove the Makefile</span>
    rm orgmk.mk
}

<span class="org-comment-delimiter"># </span><span class="org-comment">perform housekeeping on program exit or a variety of signals</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">(EXIT, HUP, INT, QUIT, TERM)</span>
<span class="org-keyword">trap</span> CleanUp 0 1 2 3 15
</pre>
</div>

<div class="org-src-container">

<pre class="src src-shell"><span class="org-comment-delimiter"># </span><span class="org-comment">install the Makefile where you are</span>
orgmk-stow-orgmk.mk

<span class="org-variable-name">FLAGS</span>=<span class="org-string">""</span>
<span class="org-keyword">while </span><span class="org-builtin">true</span>; <span class="org-keyword">do</span>
    <span class="org-keyword">case</span> <span class="org-string">"$1"</span><span class="org-keyword"> in</span>
        -h | --help ) Usage ;;
        -r | --recursive) <span class="org-variable-name">FLAGS</span>=<span class="org-string">"ALLSUBDIRS=yes"</span>; <span class="org-builtin">shift</span> ;;
        * ) <span class="org-keyword">break</span> ;;
    <span class="org-keyword">esac</span>
<span class="org-keyword">done</span>

make -f orgmk.mk $<span class="org-variable-name">FLAGS</span> $<span class="org-variable-name">*</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline75" class="outline-3">
<h3 id="orgheadline75"><span class="section-number-3">1.9</span> Orgmk configuration file</h3>
<div class="outline-text-3" id="text-1-9">
<p>
I use a setup file <code>orgmk.el</code> to hold minimal customization.
</p>

<div class="info">
<p>
In batch mode, [&#x2026;] Emacs functions that normally print a message in the echo
area will print to either the standard output stream (<code>stdout</code>) or the standard
error stream (<code>stderr</code>) instead. (To be precise, functions like <code>prin1</code>, <code>princ</code> and
<code>print</code> print to <code>stdout</code>, while <code>message</code> and <code>error</code> print to <code>stderr</code>.)
</p>

</div>
</div>

<div id="outline-container-orgheadline71" class="outline-4">
<h4 id="orgheadline71"><span class="section-number-4">1.9.1</span> Common</h4>
<div class="outline-text-4" id="text-1-9-1">
<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;; </span><span class="org-comment">orgmk.el --- Emacs configuration file for `</span><span class="org-constant"><span class="org-comment">orgmk</span></span><span class="org-comment">'</span>

<span class="org-comment-delimiter">;;; </span><span class="org-comment">Commentary:</span>

<span class="org-comment-delimiter">;;; </span><span class="org-comment">Code:</span>
</pre>
</div>
</div>

<div id="outline-container-orgheadline58" class="outline-5">
<h5 id="orgheadline58">Library Search</h5>
<div class="outline-text-5" id="text-orgheadline58">
<p>
Remember current directory.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">remember this directory</span>
(<span class="org-keyword">defconst</span> <span class="org-variable-name">orgmk-el-directory</span>
  (file-name-directory (or load-file-name (buffer-file-name)))
  <span class="org-doc">"Directory path of Orgmk."</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline59" class="outline-5">
<h5 id="orgheadline59">Feedback</h5>
<div class="outline-text-5" id="text-orgheadline59">
<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">;; activate debugging</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(setq debug-on-error t)</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">no limit when printing values</span>
(setq eval-expression-print-length nil)
(setq eval-expression-print-level nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline60" class="outline-5">
<h5 id="orgheadline60">Auto Save</h5>
<div class="outline-text-5" id="text-orgheadline60">
<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">don't make a backup of files</span>
(setq backup-inhibited t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline61" class="outline-5">
<h5 id="orgheadline61">Initialization for MS Windows</h5>
<div class="outline-text-5" id="text-orgheadline61">
<p>
When running an native Microsoft Windows version of Emacs:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">;; let Emacs recognize Cygwin paths (e.g. /usr/local/lib)</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(add-to-list 'load-path "~/Downloads/emacs/site-lisp") ;; &lt;- adjust</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(when (eq system-type 'windows-nt)</span>
<span class="org-comment-delimiter">;;   </span><span class="org-comment">(when (try-require 'cygwin-mount)</span>
<span class="org-comment-delimiter">;;     </span><span class="org-comment">(cygwin-mount-activate)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline62" class="outline-5">
<h5 id="orgheadline62">Shell</h5>
<div class="outline-text-5" id="text-orgheadline62">
<p>
Fix the shell to use: the <b>default value of shell-file-name</b> (that is the
program <code>/bin/bash</code>) is not found under Windows Emacs.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">shell</span>
(message <span class="org-string">"Current value of `</span><span class="org-constant"><span class="org-string">shell-file-name</span></span><span class="org-string">': %s"</span> shell-file-name)
(<span class="org-keyword">unless</span> (equal shell-file-name <span class="org-string">"bash"</span>)
  (setq shell-file-name <span class="org-string">"bash"</span>)
  (message <span class="org-string">"... changed to: %s"</span> shell-file-name))
</pre>
</div>

<p>
This is important when launching external tools, such as <code>PDFLaTeX</code> or <code>Latexmk</code>.
</p>
</div>
</div>

<div id="outline-container-orgheadline63" class="outline-5">
<h5 id="orgheadline63">Installation of version 8 or later</h5>
<div class="outline-text-5" id="text-orgheadline63">
<p>
Ensure that a recent version of Org mode is installed and loaded.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">when</span> (locate-library <span class="org-string">"package"</span>)
  (<span class="org-keyword">require</span> '<span class="org-constant">package</span>)
  (add-to-list 'package-archives '(<span class="org-string">"org"</span> . <span class="org-string">"http://orgmode.org/elpa/"</span>))
  (add-to-list 'package-archives '(<span class="org-string">"melpa"</span> . <span class="org-string">"http://melpa.milkbox.net/packages/"</span>))
  (package-initialize))
</pre>
</div>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">unless</span> (locate-library <span class="org-string">"ox"</span>)           <span class="org-comment-delimiter">; </span><span class="org-comment">trick to detect the presence of Org 8</span>
  (ding)
  (message <span class="org-string">"The versions 6 and 7 of Org mode are no longer supported"</span>)
  (message <span class="org-string">"Time to upgrade, don't you think?"</span>)
  (<span class="org-keyword">when</span> (locate-library <span class="org-string">"package"</span>)
    (<span class="org-keyword">let</span> ((pkg 'org))
      (<span class="org-keyword">if</span> (yes-or-no-p (format <span class="org-string">"Install package `</span><span class="org-constant"><span class="org-string">%s</span></span><span class="org-string">'? "</span> pkg))
          (<span class="org-keyword">ignore-errors</span>
            (package-install pkg))
        (setq debug-on-error nil)
        (<span class="org-warning">error</span> <span class="org-string">"Please upgrade to 8 or later"</span>)))))
</pre>
</div>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">when</span> (locate-library <span class="org-string">"package"</span>)
  (<span class="org-keyword">unless</span> (locate-library <span class="org-string">"htmlize"</span>)    <span class="org-comment-delimiter">; </span><span class="org-comment">for syntax highlighting in org2html</span>
    (<span class="org-keyword">let</span> ((pkg 'htmlize))
      (<span class="org-keyword">if</span> (yes-or-no-p (format <span class="org-string">"Install package `</span><span class="org-constant"><span class="org-string">%s</span></span><span class="org-string">'? "</span> pkg))
          (<span class="org-keyword">ignore-errors</span>
            (package-install pkg))))))
</pre>
</div>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">version info</span>
(<span class="org-keyword">let</span> ((org-install-dir (file-name-directory (locate-library <span class="org-string">"org-loaddefs"</span>)))
      (org-dir (file-name-directory (locate-library <span class="org-string">"org"</span>)))) <span class="org-comment-delimiter">; </span><span class="org-comment">org.(el|elc)</span>
  (message <span class="org-string">"Org mode version %s (org @ %s)"</span>
           (org-version)
           (<span class="org-keyword">if</span> (string= org-dir org-install-dir)
               org-install-dir
             (concat <span class="org-string">"mixed installation! "</span> org-install-dir <span class="org-string">" and "</span> org-dir))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline64" class="outline-5">
<h5 id="orgheadline64">Activation</h5>
<div class="outline-text-5" id="text-orgheadline64">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">org</span>)
(<span class="org-keyword">require</span> '<span class="org-constant">org-clock</span>)
(<span class="org-keyword">require</span> '<span class="org-constant">ox</span>)

(add-to-list 'auto-mode-alist '(<span class="org-string">"\\.txt\\'"</span> . org-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline65" class="outline-5">
<h5 id="orgheadline65">Language Environment</h5>
<div class="outline-text-5" id="text-orgheadline65">
<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">make sure that timestamps appear in English</span>
(setq system-time-locale <span class="org-string">"C"</span>)           <span class="org-comment-delimiter">; </span><span class="org-comment">[default: nil]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline66" class="outline-5">
<h5 id="orgheadline66">Clock table</h5>
<div class="outline-text-5" id="text-orgheadline66">
<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">format string used when creating CLOCKSUM lines and when generating a</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">time duration (avoid showing days)</span>
(setq org-time-clocksum-format
      '(<span class="org-builtin">:hours</span> <span class="org-string">"%d"</span> <span class="org-builtin">:require-hours</span> t <span class="org-builtin">:minutes</span> <span class="org-string">":%02d"</span> <span class="org-builtin">:require-minutes</span> t))

<span class="org-comment-delimiter">;; </span><span class="org-comment">format string for the total time cells</span>
(setq org-clock-total-time-cell-format <span class="org-string">"%s"</span>)

<span class="org-comment-delimiter">;; </span><span class="org-comment">format string for the file time cells</span>
(setq org-clock-file-time-cell-format <span class="org-string">"%s"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline67" class="outline-5">
<h5 id="orgheadline67">Markup</h5>
<div class="outline-text-5" id="text-orgheadline67">
<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">hide the emphasis marker characters</span>
(setq org-hide-emphasis-markers t)      <span class="org-comment-delimiter">; </span><span class="org-comment">impact on table alignment!</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline68" class="outline-5">
<h5 id="orgheadline68">Export options</h5>
<div class="outline-text-5" id="text-orgheadline68">
<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">don't insert a time stamp into the exported file</span>
(setq org-export-time-stamp-file nil)

<span class="org-comment-delimiter">;; </span><span class="org-comment">activate smart quotes during export (convert " to \og, \fg in French)</span>
(setq org-export-with-smart-quotes t)   <span class="org-comment-delimiter">; </span><span class="org-comment">curly quotes in HTML</span>

<span class="org-comment-delimiter">;; </span><span class="org-comment">interpret "_" and "^" for export when braces are used</span>
(setq org-export-with-sub-superscripts '{})

<span class="org-comment-delimiter">;; </span><span class="org-comment">allow #+BIND to define local variable values for export</span>
(setq org-export-allow-bind-keywords t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline69" class="outline-5">
<h5 id="orgheadline69">Org-Babel</h5>
<div class="outline-text-5" id="text-orgheadline69">
<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">configure Babel to support most languages</span>
(add-to-list 'org-babel-load-languages '(R . t)) <span class="org-comment-delimiter">; </span><span class="org-comment">Requires R and ess-mode.</span>
(add-to-list 'org-babel-load-languages '(awk . t))
(add-to-list 'org-babel-load-languages '(ditaa . t)) <span class="org-comment-delimiter">; </span><span class="org-comment">Sudo aptitude install openjdk-6-jre.</span>
(add-to-list 'org-babel-load-languages '(dot . t))
(add-to-list 'org-babel-load-languages '(java . t))
(add-to-list 'org-babel-load-languages '(latex . t)) <span class="org-comment-delimiter">; </span><span class="org-comment">Shouldn't you use #+begin/end_latex blocks instead?</span>
(add-to-list 'org-babel-load-languages '(ledger . t)) <span class="org-comment-delimiter">; </span><span class="org-comment">Requires ledger.</span>
(add-to-list 'org-babel-load-languages '(makefile . t))
(add-to-list 'org-babel-load-languages '(org . t))
(<span class="org-keyword">if</span> (locate-library <span class="org-string">"ob-shell"</span>)         <span class="org-comment-delimiter">; </span><span class="org-comment">ob-sh renamed on 2013-12-13</span>
    (add-to-list 'org-babel-load-languages '(shell . t))
  (add-to-list 'org-babel-load-languages '(sh . t)))
(add-to-list 'org-babel-load-languages '(sql . t))

(org-babel-do-load-languages            <span class="org-comment-delimiter">; </span><span class="org-comment">loads org, gnus-sum, etc...</span>
 'org-babel-load-languages org-babel-load-languages)

<span class="org-comment-delimiter">;; </span><span class="org-comment">accented characters on graphics</span>
(setq org-babel-R-command
      (concat org-babel-R-command <span class="org-string">" --encoding=UTF-8"</span>))

<span class="org-comment-delimiter">;; </span><span class="org-comment">don't require confirmation before evaluating code blocks</span>
(setq org-confirm-babel-evaluate nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline70" class="outline-5">
<h5 id="orgheadline70">Library of Babel</h5>
<div class="outline-text-5" id="text-orgheadline70">
<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">load up Babel libraries</span>
(<span class="org-keyword">let</span> ((lob-file (concat (file-name-directory (locate-library <span class="org-string">"org"</span>))
                        <span class="org-string">"../doc/library-of-babel.org"</span>)))
  (<span class="org-keyword">when</span> (file-exists-p lob-file)
    (org-babel-lob-ingest lob-file)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline72" class="outline-4">
<h4 id="orgheadline72"><span class="section-number-4">1.9.2</span> HTML export</h4>
<div class="outline-text-4" id="text-1-9-2">
<div class="inlinetask">
<b><span class="todo TODO">TODO</span> Understand the hidden xx used for spacing levels in column views</b><br  />
<p>
Depending on interactive vs batch export to HTML, we still have the above
difference in the resulting HTML file.
</p>
</div>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">when</span> (<span class="org-keyword">require</span> '<span class="org-constant">ox-html</span>)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">export the CSS selectors only, when formatting code snippets</span>
  (setq org-html-htmlize-output-type 'css)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">;; XML encoding</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq org-html-xml-declaration</span>
  <span class="org-comment-delimiter">;;       </span><span class="org-comment">'(("html" . "&lt;!-- &lt;xml version=\"1.0\" encoding=\"%s\"&gt; --&gt;")))</span>

  <span class="org-comment-delimiter">;; </span><span class="org-comment">coding system for HTML export</span>
  (setq org-html-coding-system 'utf-8)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">;; format for the HTML postamble</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(setq org-html-postamble</span>
  <span class="org-comment-delimiter">;;       </span><span class="org-comment">"  &lt;div id=\"footer\"&gt;&lt;div id=\"copyright\"&gt;\n    Copyright &amp;copy; %d %a\n  &lt;/div&gt;&lt;/div&gt;")</span>

  <span class="org-comment-delimiter">;; </span><span class="org-comment">don't include the JavaScript snippets in exported HTML files</span>
  (setq org-html-head-include-scripts nil)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">turn inclusion of the default CSS style off</span>
  (setq org-html-head-include-default-style nil)

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-html-export-body-only-to-html</span> ()
    <span class="org-doc">"Export only code between between \"&lt;body&gt;\" and \"&lt;/body&gt;\" tags to a HTML file."</span>
    (interactive)
    (org-html-export-to-html nil nil nil t)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline73" class="outline-4">
<h4 id="orgheadline73"><span class="section-number-4">1.9.3</span> PDF LaTeX export</h4>
<div class="outline-text-4" id="text-1-9-3">
<div class="inlinetask">
<b><span class="todo TODO">TODO</span> Since <span class="timestamp-wrapper"><span class="timestamp">[2012-10-26 Fri]</span></span>, the %b now means the real base name (no full part).</b><br  />
nil</div>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">when</span> (<span class="org-keyword">require</span> '<span class="org-constant">ox-latex</span>)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">;; This is disturbing when calling `</span><span class="org-constant"><span class="org-comment">org2html</span></span><span class="org-comment">'.</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(when (executable-find "latexmk")</span>
  <span class="org-comment-delimiter">;;   </span><span class="org-comment">(message "%s" (shell-command-to-string "latexmk --version")))</span>

  (setq org-latex-pdf-process
        (<span class="org-keyword">if</span> (eq system-type 'cygwin) <span class="org-comment-delimiter">;; </span><span class="org-comment">running a Cygwin version of Emacs</span>
            <span class="org-comment-delimiter">;; </span><span class="org-comment">use Latexmk (if installed with LaTeX)</span>
            (<span class="org-keyword">if</span> (executable-find <span class="org-string">"latexmk"</span>)
                '(<span class="org-string">"latexmk -CF -pdf $(cygpath -m %f) &amp;&amp; latexmk -c"</span>)
              '(<span class="org-string">"pdflatex -interaction=nonstopmode -output-directory=%o $(cygpath -m %f)"</span>
                <span class="org-string">"pdflatex -interaction=nonstopmode -output-directory=%o $(cygpath -m %f)"</span>
                <span class="org-string">"pdflatex -interaction=nonstopmode -output-directory=%o $(cygpath -m %f)"</span>))
          (<span class="org-keyword">if</span> (executable-find <span class="org-string">"latexmk"</span>)
              '(<span class="org-string">"latexmk -CF -pdf %f &amp;&amp; latexmk -c"</span>)
            '(<span class="org-string">"pdflatex -interaction=nonstopmode -output-directory=%o %f"</span>
              <span class="org-string">"pdflatex -interaction=nonstopmode -output-directory=%o %f"</span>
              <span class="org-string">"pdflatex -interaction=nonstopmode -output-directory=%o %f"</span>))))

  (message <span class="org-string">"LaTeX command: %S"</span> org-latex-pdf-process)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">tell org to use `</span><span class="org-constant"><span class="org-comment">listings</span></span><span class="org-comment">' (instead of `</span><span class="org-constant"><span class="org-comment">verbatim</span></span><span class="org-comment">') for source code</span>
  (setq org-latex-listings t)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">default packages to be inserted in the header</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">include the `</span><span class="org-constant"><span class="org-comment">listings</span></span><span class="org-comment">' package for fontified source code</span>
  (add-to-list 'org-latex-packages-alist '(<span class="org-string">""</span> <span class="org-string">"listings"</span>) t)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">include the `</span><span class="org-constant"><span class="org-comment">xcolor</span></span><span class="org-comment">' package for colored source code</span>
  (add-to-list 'org-latex-packages-alist '(<span class="org-string">""</span> <span class="org-string">"xcolor"</span>) t)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">include the `</span><span class="org-constant"><span class="org-comment">babel</span></span><span class="org-comment">' package for language-specific hyphenation and</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">typography</span>
  (add-to-list 'org-latex-packages-alist '(<span class="org-string">"english"</span> <span class="org-string">"babel"</span>) t)

  <span class="org-comment-delimiter">;; </span><span class="org-comment">default position for LaTeX figures</span>
  (setq org-latex-default-figure-position <span class="org-string">"!htbp"</span>)

  (<span class="org-keyword">defun</span> <span class="org-function-name">org-latex-export-body-only-to-latex</span> ()
    <span class="org-doc">"Export only code between \"\begin{document}\" and \"\end{document}\" to a LaTeX file."</span>
    (interactive)
    (org-latex-export-to-latex nil nil nil t)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline74" class="outline-4">
<h4 id="orgheadline74"><span class="section-number-4">1.9.4</span> Extra customization files</h4>
<div class="outline-text-4" id="text-1-9-4">
<p>
To allow you to easily add extra settings to the above &ldquo;standard&rdquo; ones, you can
create several files in the <code>lisp</code> directory. All of them will be loaded at the
end of <code>orgmk</code>&rsquo;s initialization.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">require all files from `</span><span class="org-constant"><span class="org-comment">lisp</span></span><span class="org-comment">' directory</span>
(<span class="org-keyword">dolist</span> (file (directory-files
               (concat orgmk-el-directory <span class="org-string">"../lisp/"</span>) t <span class="org-string">".+\\.elc?$"</span>))
  (load-file file))
</pre>
</div>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;; </span><span class="org-comment">orgmk.el ends here</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline77" class="outline-3">
<h3 id="orgheadline77"><span class="section-number-3">1.10</span> Sample parameters</h3>
<div class="outline-text-3" id="text-1-10">
</div><div id="outline-container-orgheadline76" class="outline-4">
<h4 id="orgheadline76"><span class="section-number-4">1.10.1</span> Custom LaTeX classes</h4>
<div class="outline-text-4" id="text-1-10-1">
<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;;; </span><span class="org-comment">org-latex-classes.el --- Sample configuration file for LaTeX</span>

<span class="org-comment-delimiter">;;; </span><span class="org-comment">Commentary:</span>

<span class="org-comment-delimiter">;;; </span><span class="org-comment">Code:</span>

(<span class="org-keyword">require</span> '<span class="org-constant">ox-latex</span>)

(add-to-list 'org-latex-classes
             '(<span class="org-string">"koma-article"</span>
               <span class="org-string">"\\documentclass{scrartcl}</span>
<span class="org-string">               [NO-DEFAULT-PACKAGES]</span>
<span class="org-string">               [EXTRA]"</span>
               (<span class="org-string">"\\section{%s}"</span> . <span class="org-string">"\\section*{%s}"</span>)
               (<span class="org-string">"\\subsection{%s}"</span> . <span class="org-string">"\\subsection*{%s}"</span>)
               (<span class="org-string">"\\subsubsection{%s}"</span> . <span class="org-string">"\\subsubsection*{%s}"</span>)
               (<span class="org-string">"\\paragraph{%s}"</span> . <span class="org-string">"\\paragraph*{%s}"</span>)
               (<span class="org-string">"\\subparagraph{%s}"</span> . <span class="org-string">"\\subparagraph*{%s}"</span>)))

<span class="org-comment-delimiter">;;; </span><span class="org-comment">org-latex-classes.el ends here</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline81" class="outline-3">
<h3 id="orgheadline81"><span class="section-number-3">1.11</span> Contributing</h3>
<div class="outline-text-3" id="text-1-11">
</div><div id="outline-container-orgheadline78" class="outline-4">
<h4 id="orgheadline78"><span class="section-number-4">1.11.1</span> Issues</h4>
<div class="outline-text-4" id="text-1-11-1">
<p>
Report issues and suggest features and improvements on the <a href="https://github.com/fniessen/orgmk/issues/new">GitHub issue tracker</a>.
</p>
</div>
</div>

<div id="outline-container-orgheadline79" class="outline-4">
<h4 id="orgheadline79"><span class="section-number-4">1.11.2</span> Patches</h4>
<div class="outline-text-4" id="text-1-11-2">
<p>
I love contributions!  Patches under any form are always welcome!
</p>
</div>
</div>

<div id="outline-container-orgheadline80" class="outline-4">
<h4 id="orgheadline80"><span class="section-number-4">1.11.3</span> Donations</h4>
<div class="outline-text-4" id="text-1-11-3">
<p>
If you like the orgmk project, you can show your appreciation and help support
future development by making a <a href="https://www.paypal.com/cgi-bin/webscr?cmd=_donations&amp;business=VCVAS6KPDQ4JC&amp;lc=BE&amp;item_number=orgmk&amp;currency_code=EUR&amp;bn=PP-DonationsBF:btn_donate_LG.gif:NonHosted">donation</a> through PayPal.
</p>

<p>
Regardless of the donations, orgmk will always be free both as in beer and as in
speech.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline82" class="outline-3">
<h3 id="orgheadline82"><span class="section-number-3">1.12</span> License</h3>
<div class="outline-text-3" id="text-1-12">
<p>
Copyright (C) 2011-2015 Fabrice Niessen
</p>

<p>
Author: Fabrice Niessen <br  />
Keywords: org mode export automation
</p>

<p>
This program is free software; you can redistribute it and/or modify it under
the terms of the GNU General Public License as published by the Free Software
Foundation, either version 3 of the License, or (at your option) any later
version.
</p>

<p>
This program is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
A PARTICULAR PURPOSE. See the GNU General Public License for more details.
</p>

<p>
You should have received a copy of the GNU General Public License along with
this program. If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.
</p>
</div>
</div>

<div id="outline-container-orgheadline83" class="outline-3">
<h3 id="orgheadline83"><span class="section-number-3">1.13</span> Standard disclaimer</h3>
<div class="outline-text-3" id="text-1-13">
<p>
I am furnishing this item &ldquo;as is&rdquo;. I do <b>NOT</b> provide <b>ANY WARRANTY</b> of the item
whatsoever, whether express, implied, or statutory, including, but not limited
to, any warranty of <b>MERCHANTABILITY</b> or <b>FITNESS FOR A PARTICULAR PURPOSE</b> or any
warranty that the contents of the item will be error-free.
</p>

<p>
In no respect shall I incur any liability for any damages, including, but
limited to, direct, indirect, special, or consequential damages arising out of,
resulting from, or any way connected to the use of the item, whether or not
based upon warranty, contract, tort, or otherwise; whether or not injury was
sustained by persons or property or otherwise; and whether or not loss was
sustained from, or arose out of, the results of, the item, or any services that
may be provided by me.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Fabrice Niessen</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
